var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},ecs;!function(e){function t(t,n){e.global_ref.listeners[t]=n}function n(t){delete e.global_ref.listener[t]}function r(t,n,r,i,o){void 0===i&&(i=0),void 0===o&&(o=!0),console.log("invoke by scrollScenes",n),e.global_ref.scrollings={designHeight:t,scenes:n,topContainer:r};var s=r.stage.stageHeight,a=-(t-s)/2;n.forEach(function(n,i){var o={};e.global_ref[n.name]={reference:o};var s=_(n.scene,e.global_ref[n.name].reference,null,n.name);e.global_ref[n.name].topIds=s,s.forEach(function(e){o[e].visualable&&!o[e]._prefab&&(o[e]._raw.y=o[e]._raw.y+a+t*i,r.addChild(o[e]._raw))})}),h(i)}function i(t){return e.global_ref.scrollings&&e.global_ref.scrollings.scenes&&t<e.global_ref.scrollings.scenes.length?e.global_ref.scrollings.scenes[t].name:null}function o(t){if(e.global_ref.scrollings&&e.global_ref.scrollings.scenes)for(var n=0;n<e.global_ref.scrollings.scenes.length;n++)if(e.global_ref.scrollings.scenes[n].name===t)return n;return-1}function s(t,n,r){if(r){var i={};e.global_ref[n]={reference:i};var o=_(RES.getRes(r),e.global_ref[n].reference,null,n);e.global_ref[n].topIds=o}var s=e.global_ref[t].reference[1],a=s._raw;if(a.parent){var l=e.global_ref[n].reference,h=a.x,c=a.y,o=e.global_ref[n].topIds;o.forEach(function(e){l[e].visualable&&!l[e]._prefab&&(l[e]._raw.y=c,l[e]._raw.x=h,a.parent.addChild(l[e]._raw))}),o.forEach(function(e){j(l[e])})}}function a(t,n){void 0===H.stageHeight&&(H.stageHeight=e.global_ref.scrollings.topContainer.stage.stageHeight),void 0===H.designHeight&&(H.designHeight=e.global_ref.scrollings.designHeight);var r=Math.floor(-t/H.designHeight),o=-H.designHeight*r,s=o-H.stageHeight;if(o>t&&t>=s){var a=100*(t-o)/(s-o);console.log("scene"+(r+1)+"leaving progress:"+a);var l=i(r);l&&e.global_ref.listeners[l]&&e.global_ref.listeners[l](a,!1)}var h=-H.designHeight*(r+1),c=h+H.stageHeight;if(c>t&&t>=h){var a=100*(t-c)/(h-c);console.log("scene"+(r+2)+"entering progress:"+a);var l=i(r+1);l&&e.global_ref.listeners[l]&&e.global_ref.listeners[l](a,!0)}}function l(e,t){h(o(e),t)}function h(t,n){function r(){var r=i(t);console.log(r+" start"),e.global_ref[r].topIds.forEach(function(t){return j(e.global_ref[r].reference[t])}),n&&n()}function o(){a(this.y)}var s=e.global_ref.scrollings.topContainer,l=e.global_ref.scrollings.designHeight;egret.Tween.get(s,{onChange:o,onChangeObj:s}).to({y:-t*l},800,egret.Ease.cubicInOut).call(r,s)}function c(t,n,r){r||(r=f()),e.global_ref[r]={reference:{},topIds:null};var i=_(t,e.global_ref[r].reference,n,r);return e.global_ref.topIds=i,e.global_ref[r]}function f(){for(var t=0;"scene"+t in e.global_ref;)t++;return"scene"+t}function _(e,t,n,r){var i=[];return e.forEach(function(e){return i.push(e.id)}),e.forEach(function(e){return u(e,t,r)}),i.forEach(function(e){return d(t[e],t)}),console.log("references",t),n&&(i.forEach(function(e){t[e].visualable&&!t[e]._prefab&&n.addChild(t[e]._raw)}),i.forEach(function(e){j(t[e])})),i}function u(e,t,n){var r=new B(e);t[e.id]=r,e.parent&&(r.parent=t[e.parent]),e.components.forEach(function(e){return g(e,t,n)}),e.children.forEach(function(e){return u(e,t,n)}),r.parent&&r.parent.children.push(r)}function g(e,t,n){var r=new X(e);n&&(r.sceneName=n),t[e.id]=r;var i=t[e.node];i&&i.addComponent(r)}function p(){return!1}function d(e,t){e.components.forEach(function(n){if(n._wrap_obj.name in Y)switch(n._wrap_obj.name){case"Label":n.single=!0,b(n),n.node.visualable=!0,O(n._wrap_obj.properties,n),console.log("set text color:",n.node.color),O({color:n.node.color},n.node),e._raw.addChild(n._raw);break;case"Sprite":n.single=!0,v(n),n.node.visualable=!0,e._raw.addChild(n._raw);break;case"Animation":y(n),n.node.visualable=!0}else"Canvas"===n.name?m(n):x(n,t)}),e.children.forEach(function(e){return d(e,t)})}function w(e){var t=new egret.DisplayObjectContainer;e._raw=t,k(e)}function b(e){var t=new egret.TextField;e._raw=t,e.node._relative=t,e.aligns={LEFT_TOP:[0,0],RIGHT_BOTTOM:[1,1],RIGHT_TOP:[1,0],LEFT_BOTTOM:[0,1],CENTER:[.5,.5],TOP:[.5,0],LEFT:[0,.5],BOTTOM:[.5,1],RIGHT:[1,.5]},e.resize=function(){console.log(this.node.width,this.node.height,this._raw.textWidth,this._raw.textHeight),this._raw.width=this.node.width,this._raw.height=this.node.height,this._raw.width=this._raw.textWidth,this._raw.height=this._raw.textHeight,this.node.anchorX=this.node.anchorX,this.node.anchorY=this.node.anchorY,this.node.x=this.node.x,this.node.y=this.node.y,this.textAlign=this.textAlign},Object.defineProperties(e,{stroke:{get:function(){return this._raw.stroke},set:function(e){this._raw.stroke=e}},strokeColor:{get:function(){return this._raw.strokeColor},set:function(e){this._raw.strokeColor=e}},text:{get:function(){return this._raw.text},set:function(e){this._raw.text=e,this.resize()}},size:{get:function(){return this._raw.size},set:function(e){this._raw.size=e,this.resize()}},textAlign:{get:function(){return this._align},set:function(e){this._align=e,this._raw.anchorOffsetX=this._raw.textWidth*this.aligns[e][0],this._raw.anchorOffsetY=this._raw.textHeight*this.aligns[e][1],this.node._raw&&(this._raw.x=this.node._raw.anchorOffsetX,this._raw.y=this.node._raw.anchorOffsetY)}}}),Object.defineProperties(e.node,{color:{get:function(){return this._relative.textColor},set:function(e){this._relative.textColor=e}}})}function v(e){var t=new egret.Bitmap;e._raw=t,e.node._relative=t,Object.defineProperties(e,{texture:{get:function(){return this._texture},set:function(e){this._texture=e,this._raw.texture=RES.getRes(this._texture)}}}),t.texture=RES.getRes(e._wrap_obj.properties.texture)}function y(e){var t=e.node,n=egret.Tween.get(t);e._raw=n,e.onPlayEnd=function(e,t){if(console.log(e,t),console.log(this._callBack,this._callBack_end_flag),this._callBack&&this._callBack_end_flag===t){var n=this._callBack;delete this._callBack,n()}},e.playReverse=function(e,t){for(var n=this,r=null,i=0;i<this._wrap_obj.properties.clips.length&&(r=this._wrap_obj.properties.clips[i],r.name!==e);i++)r=null;if(r)for(var i=r.keyframes.length-1;i>=0;i--){var o=r.keyframes[i];n._raw.to(o,r.durations[i]).call(n.onPlayEnd,null,[r.name,i])}},e.play=function(e,t){for(var n=this,r=egret.Tween.get(this.node),i=null,o=0;o<this._wrap_obj.properties.clips.length&&(i=this._wrap_obj.properties.clips[o],i.name!==e);o++)i=null;i&&(t&&(this._callBack=t,this._callBack_end_flag=i.keyframes.length-1),console.log("keyframes",i.keyframes),i.keyframes.forEach(function(e,t){r.to(e,i.durations[t-1]).call(n.onPlayEnd,n,[i.name,t])}))}}function m(e){}function x(t,n){if(console.log("assembleScript",t.name,t.node.name),t.name){var r=n[t.name],i=n[r];void 0===i&&(console.log("protoCompObj undefined"),r=e.global_ref[t.name],i=e.global_ref[r]);var o=i.properties;console.log("declarationObj",o),o&&E(o,t._wrap_obj.properties,t,n);for(var s in i)"properties"!==s&&(t[s]=i[s]);t.onLoad()}}function C(e,t){var n=["width","height","anchorX","anchorY","x","y","scaleX","scaleY","rotation","alpha","color"];n.forEach(function(n){n in e&&(t[n]=e[n])})}function O(e,t){for(var n in e)t[n]=e[n]}function E(e,t,n,r){console.log("injectScriptProperties",n.name,n.node.name);for(var i in e){var o=e[i];if("number"==typeof o||"string"==typeof o||"boolean"==typeof o)n[i]=i in t?t[i]:o;else if(o.type)if("string"==typeof o.type||"function"==typeof o.type)n[i]=i in t?t[i]?r[t[i]]:null:o["default"];else if(o.type instanceof Array)if(0===o.type.length)n[i]=i in t?t[i]:o["default"];else{var s=o.type[0];switch(s){case"string":case"number":case"boolean":n[i]=i in t?t[i]:o["default"];break;default:i in t?(n[i]=[],t[i].forEach(function(e){n[i].push(r[e])})):n[i]=o["default"]}}else("set"in o||"get"in o)&&Object.defineProperty(n,i,o)}}function j(e){e.components.forEach(function(e){return e.start()}),e.children.forEach(function(e){return j(e)})}function k(e){Object.defineProperties(e,{width:{get:function(){return this._width},set:function(e){this._width=e,this._relative&&(this._relative.width=e),this._raw.width=e}},height:{get:function(){return this._height},set:function(e){this._height=e,this._relative&&(this._relative.height=e),this._raw.height=e}},anchorX:{get:function(){return 0!==this.width?this._raw.anchorOffsetX/this.width:this._anchorX},set:function(e){this._anchorX=e,this._raw.anchorOffsetX=e*this.width}},anchorY:{get:function(){return 0!==this.height?this._raw.anchorOffsetY/this.height:this._anchorY},set:function(e){this._anchorY=e,this._raw.anchorOffsetY=e*this.height}},x:{get:function(){return this._x},set:function(e){this._x=e,this.parent&&this.parent._raw?this._raw.x=this.parent._raw.anchorOffsetX+e:this._raw.x=e}},y:{get:function(){return this._y},set:function(e){this._y=e,this.parent&&this.parent._raw?this._raw.y=this.parent._raw.anchorOffsetY+e:this._raw.y=e}},position:{get:function(){return{x:this.x,y:this.y}},set:function(e){this.x=e.x,this.y=e.y}},scaleX:{get:function(){return this._raw.scaleX},set:function(e){this._raw.scaleX=e}},scaleY:{get:function(){return this._raw.scaleY},set:function(e){this._raw.scaleY=e}},rotation:{get:function(){return this._raw.rotation},set:function(e){this._raw.rotation=e}},alpha:{get:function(){return this._raw.alpha},set:function(e){this._raw.alpha=e}}})}function T(t,n,r){e.global_ref[t]=r,e.global_ref[n]=t}function S(e){var t={},n=JSON.parse(JSON.stringify([e._wrap_obj])),r=n[0].id;return n.parent=null,_(n,t),t[r]}e.global_ref={listeners:{}};var H={},B=function(){function e(e){this._visualable=!1,this._prefab=!1,e&&(this._wrap_obj=e,this.type=e.type,this.name=e.name,this._prefab=e.prefab?!0:!1),this.id=0,this.parent=null,this.children=[],this.components=[]}return Object.defineProperty(e.prototype,"visualable",{get:function(){return this._visualable},set:function(e){e!==this._visualable&&(this._visualable=e,e?(this._raw||w(this),this.parent&&(this.parent.visualable=!0),C(this._wrap_obj.properties,this),this.parent&&this.parent._raw&&this.parent._raw.addChild(this._raw)):this.active=!1)},enumerable:!0,configurable:!0}),e.prototype.getChildren=function(){},e.prototype.getChildByName=function(e){for(var t=0;t<this.children.length;t++)if(this.children[t].name===e)return this.children[t];return null},e.prototype.getComponent=function(e){for(var t=0;t<this.components.length;t++)if(this.components[t].name===e)return this.components[t];return null},e.prototype.addComponent=function(e){return this._relative&&e.single?!1:(this.components.push(e),e.node=this,!0)},e.prototype.setPosition=function(e,t){this._wrap_obj&&this._wrap_obj.properties&&(this._wrap_obj.properties.x=e,this._wrap_obj.properties.y=t)},e.prototype.addChild=function(e){e.parent=this,this.children.push(e),e.visualable&&(this.visualable=!0,console.log("node.addChild",this._raw),this._raw&&(this._raw.addChild(e._raw),e.x=e.x,e.y=e.y))},e.prototype.removeChild=function(e){},e.prototype.removeAllChildren=function(){this.children.length=0,this.visualable&&(this._raw.removeChildren(),this.visualable=!1)},e}();e.Node=B,__reflect(B.prototype,"ecs.Node");var X=function(){function e(e){this.single=!1,this._raw=null,e&&(this._wrap_obj=e,this.type=e.type,this.name=e.name),this.id=0,this.node=null}return e.prototype.getComponent=function(e){return this.node.getComponent(e)},e.prototype.onLoad=function(){},e.prototype.start=function(){},e.prototype.onStop=function(){},e}();e.Component=X,__reflect(X.prototype,"ecs.Component"),e.setSceneScrollingListener=t,e.removeSceneScrollingListener=n,e.scrollScenes=r,e.getSceneNameByIndex=i,e.getIndexBySceneName=o,e.switchScene=s,e.scrollToByName=l,e.scrollTo=h,e.parseScene=c,e.saveScene=p;var Y={Label:1,Sprite:1,Animation:1};e.Class=T,e.instantiate=S}(ecs||(ecs={}));