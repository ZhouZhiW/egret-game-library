var __reflect=this&&this.__reflect||function(t,e,a){t.__class__=e,a?a.push(e):a=[e],t.__types__=t.__types__?a.concat(t.__types__):a},__extends=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)},munu=function(t){function e(){var e=t.call(this)||this;return e.addbtn(),e}return __extends(e,t),e.prototype.addbtn=function(){var t=egret.MainContext.instance.stage.stageWidth,e=egret.MainContext.instance.stage.stageHeight;this.touchEnabled=!0;var a=new egret.Sprite;a.graphics.beginFill(0,.5),a.graphics.drawRect(0,0,t,e),a.graphics.endFill(),this.addChild(a);var r=this;data.createBtn("continue_png",function(){r.parent&&r.parent.removeChild(r)},t/2,e/2-100,this);var i=new overAndMunu;this.addChild(i)},e}(egret.Sprite);__reflect(munu.prototype,"munu");var addDaoju=function(t){function e(){var e=t.call(this)||this;return e.addDaojuAnction(),e}return __extends(e,t),e.prototype.addDaojuAnction=function(){this.touchEnabled=!0;var t=egret.MainContext.instance.stage.stageWidth,e=egret.MainContext.instance.stage.stageHeight;this.touchEnabled=!0;var a=new egret.Sprite;a.graphics.beginFill(0,.5),a.graphics.drawRect(0,0,t,e),a.graphics.endFill(),this.addChild(a);var r=RES.getRes("sun_json"),i=RES.getRes("sun_png"),o=new egret.MovieClipDataFactory(r,i),n=new egret.MovieClip(o.generateMovieClipData("sun"));this.addChild(n),n.play(2),n.x=egret.MainContext.instance.stage.stageWidth/2-n.width/2-10,n.y=egret.MainContext.instance.stage.stageHeight/2-n.height/2-10,n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2;var s=[{url:"refresh_png",_x:450,_y:920},{url:"transform_png",_x:600,_y:920}],d=Math.floor(2*Math.random()),_=s[d].url,h=new egret.Bitmap;h.texture=RES.getRes(_),this.addChildAt(h,10),h.x=egret.MainContext.instance.stage.stageWidth/2,h.y=egret.MainContext.instance.stage.stageHeight/2,h.anchorOffsetX=h.width/2,h.anchorOffsetY=h.height/2,this.addChild(h);var c=this;n.addEventListener(egret.Event.COMPLETE,function(t){var e=s[d]._x,a=s[d]._y;n.parent&&(n.parent.removeChild(n),egret.Tween.get(h).to({x:e,y:a,scaleX:.5,scaleY:.5},1e3).call(function(){0==d?(data.UPDATE_data++,console.log("ssss",data.Game_Layer),data.Game_Layer._updatedata.text=data.UPDATE_data.toString()):(data.ROTATION_data++,console.log("ssss",data.Game_Layer),data.Game_Layer._rotationdata.text=data.ROTATION_data.toString()),c.parent.removeChild(c)}))},this)},e}(egret.Sprite);__reflect(addDaoju.prototype,"addDaoju");var game=function(t){function e(){var e=t.call(this)||this;e.glodBg_Array=[],e.ISCANDOWN=!1,e.move_Y=200,data.Game_Layer=e;var a=JSON.parse(egret.localStorage.getItem("saveDataArray"));return data.readDateArray=a,console.log(data.readDateArray),e.createGameScene(),e}return __extends(e,t),e.prototype.createGameScene=function(){this.main_map=new Map,this.addChildAt(this.main_map,1),this.addBtn(),this._GroupRect=new GroupRect,this.addChildAt(this._GroupRect,5),this.touchEnabled=!0,this.addScorePanel(),data.readDateArray&&null!=data.readDateArray._level?data._level=data.readDateArray._level-1:data._level=0,this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onClick_This_Move,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick_This_End,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClick_This_Begin,this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onClick_This_Cancel,this),this.CheckGameOVer()},e.prototype.onClick_This_Begin=function(t){for(var e=0,a=0;a<data.click_post.length;a++){var r=data.click_post[a].minx,i=data.click_post[a].maxX,o=data.click_post[a].miny,n=data.click_post[a].maxy;data.click_post[a].click&&t.stageX<i&&t.stageX>=r&&t.stageY>=o&&t.stageY<n&&(e=a,this._GroupRect.ISCLICK=!0)}this._GroupRect.ISCLICK&&(this._GroupRect.getid=e,this._GroupRect._group[this._GroupRect.getid].scaleX=1,this._GroupRect._group[this._GroupRect.getid].scaleY=1,this._GroupRect._group[this._GroupRect.getid].x=t.stageX,this._GroupRect._group[this._GroupRect.getid].y=t.stageY-this.move_Y,this.setChildIndex(this._GroupRect,this.numChildren-1))},e.prototype.onClick_This_Move=function(t){if(this._GroupRect.ISCLICK){var e=data.rect_x-30,a=data.rect_x+data.map_col*data.rect_width-30,r=data.rect_y-30,i=data.rect_y+data.map_row*data.rect_width-30;if(t.stageX>=e&&t.stageX<=a&&t.stageY-this.move_Y>r&&t.stageY-this.move_Y<i){for(var o=0,n=0;n<this._GroupRect._group[this._GroupRect.getid]._rect.length;n++){var s=this._GroupRect._group[this._GroupRect.getid]._rect[n].x+t.stageX,d=this._GroupRect._group[this._GroupRect.getid]._rect[n].y+t.stageY-this.move_Y;s>=e&&a>=s&&d>r&&i>d&&o++}if(o==this._GroupRect._group[this._GroupRect.getid]._rect.length){var _=this.main_map.Map_Array.length,h=this._GroupRect._group[this._GroupRect.getid]._rect.length;this.click_num=this._GroupRect._group[this._GroupRect.getid]._rect.length;for(var s=this._GroupRect._group[this._GroupRect.getid]._rect[0].x+t.stageX,c=this.main_map.Map_Array[0].x,p=Math.pow(s-c,2),d=this._GroupRect._group[this._GroupRect.getid]._rect[0].y+t.stageY-this.move_Y,g=this.main_map.Map_Array[0].y,l=Math.pow(d-g,2),u=Math.sqrt(p+l),y=[],m=0,n=0;h>n;n++){for(var v=0;_>v;v++){var s=this._GroupRect._group[this._GroupRect.getid]._rect[n].x+t.stageX,c=this.main_map.Map_Array[v].x,p=Math.pow(s-c,2),d=this._GroupRect._group[this._GroupRect.getid]._rect[n].y+t.stageY-this.move_Y,g=this.main_map.Map_Array[v].y,l=Math.pow(d-g,2),R=Math.sqrt(p+l);u>=R&&(u=R,m=v)}30>=u&&!this.main_map.Map_Array[m].canDown&&y.push({Map_index:m,_index:n,min_xy:u})}if(y.length==h){var f=this.glodBg_Array.length;if(f>0)if(this.main_map.Map_Array[0].x==this.glodBg_Array[0].x&&this.main_map.Map_Array[0].y==this.glodBg_Array[0].y);else for(var n=0;f>n;n++)for(var v=0;v<y.length;v++)this.glodBg_Array[n].x=this.main_map.Map_Array[y[n].Map_index].x,this.glodBg_Array[n].y=this.main_map.Map_Array[y[n].Map_index].y;else for(var n=0;n<y.length;n++)this.createGoldSprite(this.main_map.Map_Array[y[n].Map_index].x,this.main_map.Map_Array[y[n].Map_index].y)}else this.remove_glodBg_Array()}else this.remove_glodBg_Array()}else this.remove_glodBg_Array();this._GroupRect._group[this._GroupRect.getid].x=t.stageX,this._GroupRect._group[this._GroupRect.getid].y=t.stageY-this.move_Y}},e.prototype.onClick_This_End=function(t){if(this._GroupRect.ISCLICK){var e=this._GroupRect._group[this._GroupRect.getid]._rect.length;if(this._GroupRect._group[this._GroupRect.getid]._rect.length==this.glodBg_Array.length){for(var a=0;a<this._GroupRect._group[this._GroupRect.getid]._rect.length;a++){var r=this._GroupRect._group[this._GroupRect.getid]._rect[a];if(this._GroupRect._group[this._GroupRect.getid]._rect[a].parent){this._GroupRect._group[this._GroupRect.getid]._rect[a].parent.removeChild(this._GroupRect._group[this._GroupRect.getid]._rect[a]),this.addChild(r),r.x=this.glodBg_Array[a].x,r.y=this.glodBg_Array[a].y;for(var i=0;i<this.main_map.Map_Array.length;i++)if(r.x==this.main_map.Map_Array[i].x&&r.y==this.main_map.Map_Array[i].y){this.main_map.Map_Array[i].canDown=!0;var o=Math.floor(i/10),n=i%10;r.ROW=o,r.COL=n,data.Block_Array[o*data.map_row+n]=r}}}this.checkRect(),data.CLICKNUM--,console.log("  data.CLICKNUM",data.CLICKNUM);for(var s=0;s<data.rect_num_Array.length;s++)data.rect_num_Array[s]==this._GroupRect.getid&&data.rect_num_Array.splice(s,1);data.click_post[this._GroupRect.getid].click=!1,0==data.CLICKNUM&&this.CreateNewGroupRect(),data.Score+=e,this.Score_text.text=data.Score.toString(),this.timerHandler(e),data.Start_Layer.sound2.play(0,1);for(var d=[],_=[],s=0;s<data.Block_Array.length;s++)if(data.Block_Array[s]){var h=data.Block_Array[s];d.push({rect_color:h.COLOR,rect_x:h.x,rect_y:h.y,rect_row:h.ROW,rect_col:h.COL,rect_type:h.TYPE,rect_rotationtype:h.ROTATIONTYPE,rect_canremove:h.CANREMOVE})}for(var c=0;c<data.rect_num_Array.length;c++){var p=[];if(this._GroupRect._group[c]){for(var g=0;g<this._GroupRect._group[c]._rect.length;g++){var h=this._GroupRect._group[c]._rect[g];p.push({rect_color:h.COLOR,rect_x:h.x,rect_y:h.y,rect_row:h.ROW,rect_col:h.COL,rect_type:h.TYPE,rect_rotationtype:h.ROTATIONTYPE,rect_canremove:h.CANREMOVE,rect_CLICKNUM:data.rect_num_Array[c]})}_[_.length]=p}}var l=this._progressBar.value,u=data.Score;data.readDateArray&&null!=data.readDateArray._bestScore?data.Score>data.BestScore?data.BestScore=data.Score:data.BestScore=data.readDateArray._bestScore:data.BestScore=data.Score;var y=data.BestScore,m=data.UPDATE_data,v=data.ROTATION_data,R=this._progressBar.maximum,f=data._level+1;this.SaveData(d,_,l,R,u,y,m,v,f)}else this._GroupRect._group[this._GroupRect.getid].scaleX=.5,this._GroupRect._group[this._GroupRect.getid].scaleY=.5,this._GroupRect._group[this._GroupRect.getid].x=data.DOWN_POSTION[this._GroupRect.getid][0],this._GroupRect._group[this._GroupRect.getid].y=data.DOWN_POSTION[this._GroupRect.getid][1];this.remove_glodBg_Array(),this._GroupRect.ISCLICK=!1,this.CheckGameOVer()}},e.prototype.SaveData=function(t,e,a,r,i,o,n,s,d){if(t&&(data.saveDataArray.gameArray.up_game=t),e){data.saveDataArray.gameArray.down_game=[];for(var _=0;_<data.saveDataArray.gameArray.down_game.length;_++)data.saveDataArray.gameArray.down_game.splice(_,1),_--;data.saveDataArray.gameArray.down_game=e}a&&(data.saveDataArray._value=a),(r||0==r)&&(data.saveDataArray._Maxvalue=r),d&&(data.saveDataArray._level=d),i&&(data.saveDataArray._score=i),o&&(data.saveDataArray._bestScore=o),(n||0==n)&&(data.saveDataArray._update_num=n),(s||0==s)&&(data.saveDataArray._rotation_num=s),console.log("保存",data.saveDataArray),egret.localStorage.setItem("saveDataArray",JSON.stringify(data.saveDataArray))},e.prototype.CheckGameOVer=function(){for(var t=!0,e=0;e<data.rect_num_Array.length;e++){for(var a=0;a<this.main_map.Map_Array.length;a++){for(var r=[],i=0;i<this._GroupRect._group[data.rect_num_Array[e]]._rect.length;i++){var o=this._GroupRect._group[data.rect_num_Array[e]]._rect[0].x,n=this._GroupRect._group[data.rect_num_Array[e]]._rect[i].x,s=this._GroupRect._group[data.rect_num_Array[e]]._rect[0].y,d=this._GroupRect._group[data.rect_num_Array[e]]._rect[i].y,_=this.main_map.Map_Array[a].row-(s-d)/60,h=this.main_map.Map_Array[a].col-(o-n)/60;r.push({_row:_,_col:h})}for(var c=0,p=0;p<r.length;p++){var g=r[p]._row,l=r[p]._col;if(!(g>=0&&g<data.map_row&&l>=0&&l<data.map_col)){t=!1;break}this.main_map.Map_Array[g*data.map_row+l]&&!this.main_map.Map_Array[g*data.map_row+l].canDown&&c++}if(c==r.length){t=!0;break}t=!1}if(t)break}if(t);else{var u=new TimerPanel;data.Main_Layer.addChild(u),u.start()}},e.prototype.CreateNewGroupRect=function(){data.CLICKNUM=3,data.rect_num_Array=[0,1,2],this._GroupRect=new GroupRect,this.addChildAt(this._GroupRect,5);for(var t=0;t<data.click_post.length;t++)data.click_post[t].click=!0},e.prototype.onClick_This_Cancel=function(){this._GroupRect.ISCLICK&&(this._GroupRect._group[this._GroupRect.getid].scaleX=.5,this._GroupRect._group[this._GroupRect.getid].scaleY=.5,this._GroupRect._group[this._GroupRect.getid].x=data.DOWN_POSTION[this._GroupRect.getid][0],this._GroupRect._group[this._GroupRect.getid].y=data.DOWN_POSTION[this._GroupRect.getid][1],this._GroupRect.ISCLICK=!1)},e.prototype.checkRect=function(){for(var t=[],e=[],a=0;a<data.map_row;a++){for(var r=0,i=0;i<data.map_col;i++)data.Block_Array[a*data.map_row+i]||r++;if(0==r){for(var o=[],n=0;n<data.map_col;n++)o.push(data.Block_Array[a*data.map_row+n]);for(var s=egret.MainContext.instance.stage.stageWidth/2,d=o[0].y,_=o[0].COLOR,h=!0,c=0;c<o.length;c++)o[c].COLOR!=_&&(h=!1);t[t.length]={needRemoveRect:o,x:s,y:d,rotation:0,color:h}}}for(var a=0;a<data.map_col;a++){for(var p=0,i=0;i<data.map_row;i++)data.Block_Array[i*data.map_row+a]||p++;if(0==p){for(var g=[],n=0;n<data.map_row;n++)g.push(data.Block_Array[n*data.map_row+a]);for(var _=g[0].COLOR,l=!0,c=0;c<g.length;c++)g[c].COLOR!=_&&(l=!1);var u=g[0].x+60,y=data.rect_y,m=data.rect_y+data.map_col*data.rect_width,v=(m-y)/2+y;e[e.length]={needRemoveRect:g,x:u,y:v,rotation:90,color:l}}}for(var R=[],a=0;a<e.length;a++)R.push(e[a]);for(var a=0;a<t.length;a++)R.push(t[a]);R.length>0&&this.deleteRect(R)},e.prototype.deleteRect=function(t){for(var e=0,a=0;a<t.length;a++){for(var r=0;r<t[a].needRemoveRect.length;r++)t[a].color&&e++,t[a].needRemoveRect[r].parent&&(t[a].needRemoveRect[r].parent.removeChild(t[a].needRemoveRect[r]),data.Block_Array[t[a].needRemoveRect[r].ROW*data.map_row+t[a].needRemoveRect[r].COL]=null,this.main_map.Map_Array[t[a].needRemoveRect[r].ROW*data.map_row+t[a].needRemoveRect[r].COL].canDown=!1,r--);this.CreateAnction(t[a].x,t[a].y,t[a].rotation);var i=0;i=e>0?2*(10*Math.pow(2,e)+10*(e-1))+(10*Math.pow(2,t.length-e)+10*(t.length-e-1)):10*Math.pow(2,t.length)+10*(t.length-1),data.Score+=i,this.Score_text.text=data.Score.toString(),this.timerHandler(i),data.saveDataArray._score=data.Score,data.Start_Layer.sound1.play(0,1),this.SaveData(null,null,null,null,data.Score,null,null,null,null)}},e.prototype.remove_glodBg_Array=function(){for(var t=0;t<this.glodBg_Array.length;t++)this.glodBg_Array[t].parent&&(this.glodBg_Array[t].parent.removeChild(this.glodBg_Array[t]),this.glodBg_Array.splice(t,1),t--)},e.prototype.CreateAnction=function(t,e,a){var r=RES.getRes("test_json"),i=RES.getRes("test_png"),o=new egret.MovieClipDataFactory(r,i),n=new egret.MovieClip(o.generateMovieClipData("test"));this.addChild(n),n.play(1),n.rotation=a,n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.x=t,n.y=e,n.addEventListener(egret.Event.COMPLETE,function(t){n.parent&&n.parent.removeChild(n)},this)},e.prototype.addBtn=function(){var t=egret.MainContext.instance.stage.stageWidth,e=(egret.MainContext.instance.stage.stageHeight,this);data.createBtn("button_01_png",function(){var t=new munu;e.addChild(t)},t-80,120,this);var a=this.createBitmapByName("refresh_png");this.addChildAt(a,10),a.x=egret.MainContext.instance.stage.stageWidth/2+a.width/2,a.y=data.map_row*data.rect_width+data.rect_y+a.height/2,a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(data.UPDATE_data>0){data.UPDATE_data--,this._updatedata.text=data.UPDATE_data.toString();for(var t=0;t<this._GroupRect._group.length;t++)this._GroupRect._group[t]&&this._GroupRect._group[t].parent.removeChild(this._GroupRect._group[t]);this.CreateNewGroupRect(),this.SaveData(null,null,null,null,null,null,data.UPDATE_data,null,null)}},this);var r=this.createBitmapByName("transform_png");r.x=a.x+r.width/2+100,r.y=data.map_row*data.rect_width+data.rect_y+r.height/2,this.addChildAt(r,10),r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(console.log("旋转底部出现的方块"),data.ROTATION_data>0){data.ROTATION_data--,this._rotationdata.text=data.ROTATION_data.toString(),this.SaveData(null,null,null,null,null,null,null,data.ROTATION_data,null);var t=new rotationPanel;data.Main_Layer.addChild(t)}},this);var i=new egret.Bitmap;i.texture=RES.getRes("number_bg_png"),this.addChildAt(i,11),i.x=egret.MainContext.instance.stage.stageWidth/2+a.width/2+65,i.y=data.map_row*data.rect_width+data.rect_y+a.height/2-5,this._updatedata=new egret.TextField,data.readDateArray&&(data.readDateArray._update_num||0==data.readDateArray._update_num)&&(data.UPDATE_data=data.readDateArray._update_num),data.readDateArray&&(data.readDateArray._rotation_num||0==data.readDateArray._rotation_num)&&(data.ROTATION_data=data.readDateArray._rotation_num),this._updatedata.text=data.UPDATE_data.toString(),this.addChild(this._updatedata),this._updatedata.size=20,this._updatedata.bold=!0,this._updatedata.x=i.x+i.width/2,this._updatedata.y=i.y+i.height/2,this._updatedata.textColor=16777215,this._updatedata.anchorOffsetX=this._updatedata.width/2,this._updatedata.anchorOffsetY=this._updatedata.height/2;var o=new egret.Bitmap;o.texture=RES.getRes("number_bg_png"),this.addChildAt(o,11),o.x=a.x+r.width/2+165,o.y=data.map_row*data.rect_width+data.rect_y+r.height/2-5,this._rotationdata=new egret.TextField,this._rotationdata.text=data.ROTATION_data.toString(),this.addChild(this._rotationdata),this._rotationdata.size=20,this._rotationdata.bold=!0,this._rotationdata.x=o.x+o.width/2,this._rotationdata.y=o.y+o.height/2,this._rotationdata.textColor=16777215,this._rotationdata.anchorOffsetX=this._rotationdata.width/2,this._rotationdata.anchorOffsetY=this._rotationdata.height/2},e.prototype.createGoldSprite=function(t,e){var a=this.createBitmapByName("geizibg_png");this.addChildAt(a,2),a.x=t,a.y=e,this.glodBg_Array.push(a),this.setChildIndex(a,2)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,a=RES.getRes(t);return e.texture=a,e},e.prototype.addScorePanel=function(){data.readDateArray&&null!=data.readDateArray._score&&(data.Score=data.readDateArray._score),data.readDateArray&&null!=data.readDateArray._bestScore&&(data.BestScore=data.readDateArray._bestScore),this.Score_text=new egret.TextField,this.Score_text.text=data.Score.toString(),this.Score_text.bold=!1,this.addChild(this.Score_text),this.Score_text.size=40,this.Score_text.bold=!0,this.Score_text.x=egret.MainContext.instance.stage.stageWidth/2-200,this.Score_text.y=100,this.Score_text.anchorOffsetX=this.Score_text.width/2,this.Score_text.anchorOffsetY=this.Score_text.height/2,this.BestScore_text=new egret.TextField,this.BestScore_text.text=data.BestScore.toString(),this.BestScore_text.bold=!1,this.addChild(this.BestScore_text),this.BestScore_text.size=40,this.BestScore_text.bold=!0,this.BestScore_text.x=egret.MainContext.instance.stage.stageWidth/2+150,this.BestScore_text.y=100,this.BestScore_text.anchorOffsetX=this.BestScore_text.width/2,this.BestScore_text.anchorOffsetY=this.BestScore_text.height/2,this.BestScore_text.textColor=15793970,this.CreateTimerTiao()},e.prototype.CreateTimerTiao=function(){var t=egret.MainContext.instance.stage.stageWidth,e=180,a=this.createBitmapByName("bar_empty_png");a.x=t/2,a.y=e,this.addChildAt(a,1),a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2;var r='<e:ProgressBar xmlns:e="http://ns.egret.com/eui">\n                <e:Skin>\n                    <e:Image id="thumb" width="100%" height="100%" source="resource/img/bar_fill.png" scale9Grid="1,1,4,4"/>\n                    <e:Label id="labelDisplay" textColor="0xffffff" horizontalCenter="0" verticalCenter="0"/>\n                </e:Skin>\n            </e:ProgressBar>',i=EXML.parse(r);this._progressBar=new i,this._progressBar.width=260,this._progressBar.height=26,data.readDateArray&&null!=data.readDateArray._value?this._progressBar.minimum=data.readDateArray._value:this._progressBar.minimum=0,data.readDateArray&&null!=data.readDateArray._Maxvalue?this._progressBar.maximum=data.readDateArray._Maxvalue:this._progressBar.maximum=data.addDaoju[data._level],this._progressBar.maximum=data.addDaoju[data._level],this._progressBar.labelDisplay=null,this._progressBar.value=0,this.addChildAt(this._progressBar,5),this._progressBar.x=t/2,this._progressBar.y=e,this._progressBar.anchorOffsetX=this._progressBar.width/2,this._progressBar.anchorOffsetY=this._progressBar.height/2;var o=this.createBitmapByName("bar_leaf_png");o.x=t/2,o.y=e,this.addChildAt(o,6),o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height/2},e.prototype.timerHandler=function(t){if(this._progressBar.value+=t,console.log(this._progressBar.maximum),this._progressBar.value>=data.addDaoju[data._level]){this._progressBar.value=0,data._level++,this._progressBar.maximum=data.addDaoju[data._level],this.SaveData(null,null,null,this._progressBar.maximum,null,null,null,null,data._level+1);var e=new addDaoju;this.addChild(e)}},e}(egret.Sprite);__reflect(game.prototype,"game");var gameOver=function(t){function e(){var e=t.call(this)||this;return e.addbtn(),e}return __extends(e,t),e.prototype.addbtn=function(){var t=egret.MainContext.instance.stage.stageWidth,e=egret.MainContext.instance.stage.stageHeight;this.touchEnabled=!0;var a=new egret.Sprite;a.graphics.beginFill(0,.5),a.graphics.drawRect(0,0,t,e),a.graphics.endFill(),this.addChild(a);var r=new egret.Bitmap;r.texture=RES.getRes("gameover_png"),this.addChild(r),r.x=t/2,r.y=e/2-100,r.anchorOffsetX=r.width/2,r.anchorOffsetY=r.height/2;var i=new overAndMunu;this.addChild(i),this.txt=new egret.TextField,this.addChild(this.txt),this.txt.width=t,this.txt.y=e/2-60,this.txt.textColor=16777215,this.txt.fontFamily="KaiTi",this.txt.bold=!0,this.txt.size=38,this.txt.textAlign=egret.HorizontalAlign.CENTER,this.txt.text=data.Score.toString(),data.updateData(),data.createBtn("share_png",function(){},t/2-120,e-100,this),data.createBtn("more_png",function(){},t/2+120,e-100,this)},e}(egret.Sprite);__reflect(gameOver.prototype,"gameOver");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=egret.MainContext.instance.stage.stageHeight/2,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e,this.textField.x=egret.MainContext.instance.stage.stageWidth/2-this.textField.width/2},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView);var e=egret.StageScaleMode.EXACT_FIT;this.stage.scaleMode=e,RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){var t=egret.localStorage.getItem("zzw_egret");t||(egret.localStorage.setItem("zzw_egret","1"),egret.localStorage.removeItem("saveDataArray")),data.Main_Layer=this;var e=new start;this.addChild(e)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Map=function(t){function e(){var e=t.call(this)||this;return e.Map_Array=[],e.rectType=["c1_png","c2_png","c3_png","c4_png","c5_png","c6_png"],e.CreateMap(),e.addUi(),data.Map_Layer=e,e}return __extends(e,t),e.prototype.CreateMap=function(){var t=this.createBitmapByName("bg2_jpg");t.width=egret.MainContext.instance.stage.stageWidth,t.height=egret.MainContext.instance.stage.stageHeight,this.addChild(t);for(var e=0;e<data.map_row;e++)for(var a=0;a<data.map_col;a++)this.Map_Array.push({row:e,col:a,x:data.rect_x+data.rect_width*a,y:data.rect_y+e*data.rect_width,canDown:!1}),this.addSprite(data.rect_x+data.rect_width*e,data.rect_y+a*data.rect_width);if(data.Is_first&&data.readDateArray&&data.readDateArray.gameArray.up_game.length>0)for(var r=0;r<data.readDateArray.gameArray.up_game.length;r++){var i=data.readDateArray.gameArray.up_game[r].rect_x,o=data.readDateArray.gameArray.up_game[r].rect_y,n=data.readDateArray.gameArray.up_game[r].rect_row,s=data.readDateArray.gameArray.up_game[r].rect_col,d=data.readDateArray.gameArray.up_game[r].rect_color;this.create_Rect(i,o,d,n,s)}},e.prototype.addSprite=function(t,e){var a=this.createBitmapByName("geizi_png");a.x=t,a.y=e,this.addChild(a)},e.prototype.addUi=function(){var t=this.createBitmapByName("achievement_png");this.addChild(t),t.x=egret.MainContext.instance.stage.stageWidth/2-t.width/2,t.y=75},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,a=RES.getRes(t);return e.texture=a,e},e.prototype.create_Rect=function(t,e,a,r,i){var o=this.rectType[a],n=new RectBool;n.texture=RES.getRes(o),this.addChild(n),n.COLOR=a,n.CANREMOVE=!1,n.x=t,n.y=e,n.ROW=r,n.COL=i,data.Block_Array[n.ROW*data.map_row+n.COL]=n,this.Map_Array[n.ROW*data.map_row+n.COL].canDown=!0},e}(egret.DisplayObjectContainer);__reflect(Map.prototype,"Map");var data=function(){function t(){}return t.createBtn=function(t,e,a,r,i){var o=new egret.Bitmap,n=RES.getRes(t);o.texture=n,i.addChildAt(o,10),o.x=a,o.y=r,o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height/2,o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e()},this)},t.updateData=function(){t.Block_Array=[];for(var e=0;e<t.click_post.length;e++)t.click_post[e].click=!0;t.Score=0,t.UPDATE_data=1,t.saveDataArray._bestScore?t.BestScore=t.saveDataArray._bestScore:t.BestScore=0,t.ROTATION_data=1,t.DOWN_NUMBER=3,t.CLICKNUM=3,t.rect_num_Array=[0,1,2],t._level=0;var a={gameArray:{up_game:[],down_game:[]},_value:0,_Maxvalue:600,_score:t.Score,_bestScore:t.BestScore,_update_num:t.UPDATE_data,_rotation_num:t.ROTATION_data,_level:t._level};egret.localStorage.setItem("saveDataArray",JSON.stringify(a))},t}();data.CLICKABLE="clickable",data.NONECLICKABLE="noneclickable",data.map_row=10,data.map_col=10,data.rect_width=60,data.rect_x=60,data.rect_y=250,data.UPDATE_data=1,data.ROTATION_data=1,data.DOWN_NUMBER=3,data.CLICKNUM=3,data.Score=0,data.BestScore=0,data.Block_Array=[],data.Is_first=!0,data.rect_num_Array=[0,1,2],data.Main_Layer=null,data.Start_Layer=null,data.Game_Layer=null,data.Timer_Layer=null,data.Map_Layer=null,data.saveDataArray={gameArray:{up_game:[],down_game:[]},_value:null,_Maxvalue:null,_score:null,_bestScore:null,_update_num:null,_rotation_num:null,_level:null},data.readDateArray=null,data.addDaoju=[600,1200,2e3,3e3,4800,6400,9600,12e3,15e3,3e4,5e4,1e5,1e11],data._level=0,data.click_post=[{minx:75,maxX:220,miny:1e3,maxy:1200,click:!0},{minx:275,maxX:425,miny:1e3,maxy:1200,click:!0},{minx:475,maxX:625,miny:1e3,maxy:1200,click:!0}],data.DOWN_POSTION=[[150,1100],[350,1100],[550,1100]],data.typeArray=[[[[0,0]],[[0,0]],[[0,0]],[[0,0]]],[[[-1,0],[0,0]],[[.5,-.5],[.5,.5]],[[-1,0],[0,0]],[[.5,-.5],[.5,.5]]],[[[0,-.5],[0,.5]],[[.5,0],[.5,0]],[[0,-.5],[0,.5]],[[.5,0],[.5,0]]],[[[-.5,-.5],[-.5,.5],[.5,.5]],[[-.5,-.5],[-.5,.5],[.5,-.5]],[[-.5,-.5],[.5,-.5],[.5,.5]],[[-.5,.5],[.5,-.5],[.5,.5]]],[[[-.5,.5],[.5,-.5],[.5,.5]],[[-.5,-.5],[-.5,.5],[.5,.5]],[[-.5,-.5],[-.5,.5],[.5,-.5]],[[-.5,-.5],[.5,-.5],[.5,.5]]],[[[0,0],[0,-1],[0,1]],[[0,0],[-1,0],[1,0]],[[0,0],[0,-1],[0,1]],[[0,0],[-1,0],[1,0]]],[[[0,0],[-1,0],[1,0]],[[0,0],[0,-1],[0,1]],[[0,0],[-1,0],[1,0]],[[0,0],[0,-1],[0,1]]],[[[-1,-.5],[0,-.5],[-1,.5],[0,.5]],[[-1,-.5],[0,-.5],[-1,.5],[0,.5]],[[-1,-.5],[0,-.5],[-1,.5],[0,.5]],[[-1,-.5],[0,-.5],[-1,.5],[0,.5]]],[[[0,-1.5],[0,-.5],[0,.5],[0,1.5]],[[-1.5,0],[-.5,0],[.5,0],[1.5,0]],[[0,-1.5],[0,-.5],[0,.5],[0,1.5]],[[-1.5,0],[-.5,0],[.5,0],[1.5,0]]],[[[-1.5,0],[-.5,0],[.5,0],[1.5,0]],[[0,-1.5],[0,-.5],[0,.5],[0,1.5]],[[-1.5,0],[-.5,0],[.5,0],[1.5,0]],[[0,-1.5],[0,-.5],[0,.5],[0,1.5]]],[[[-2,0],[-1,0],[0,0],[1,0],[2,0]],[[0,-2],[0,-1],[0,0],[0,1],[0,2]],[[-2,0],[-1,0],[0,0],[1,0],[2,0]],[[0,-2],[0,-1],[0,0],[0,1],[0,2]]],[[[0,-2],[0,-1],[0,0],[0,1],[0,2]],[[-2,0],[-1,0],[0,0],[1,0],[2,0]],[[0,-2],[0,-1],[0,0],[0,1],[0,2]],[[-2,0],[-1,0],[0,0],[1,0],[2,0]]],[[[-1,0],[-1,-1],[0,-1],[1,-1],[-1,1]],[[1,1],[1,0],[0,-1],[1,-1],[-1,-1]],[[-1,1],[0,1],[1,-1],[1,0],[1,1]],[[-1,1],[0,1],[-1,-1],[-1,0],[1,1]]],[[[-1,1],[0,1],[1,-1],[1,0],[1,1]],[[-1,1],[0,1],[-1,-1],[-1,0],[1,1]],[[-1,0],[-1,-1],[0,-1],[1,-1],[-1,1]],[[1,1],[1,0],[0,-1],[1,-1],[-1,-1]]],[[[-1,1],[-1,0],[-1,-1],[0,1],[0,-1],[0,0],[1,-1],[1,0],[1,1]],[[-1,1],[-1,0],[-1,-1],[0,1],[0,-1],[0,0],[1,-1],[1,0],[1,1]],[[-1,1],[-1,0],[-1,-1],[0,1],[0,-1],[0,0],[1,-1],[1,0],[1,1]],[[-1,1],[-1,0],[-1,-1],[0,1],[0,-1],[0,0],[1,-1],[1,0],[1,1]]]],__reflect(data.prototype,"data");var overAndMunu=function(t){function e(){var e=t.call(this)||this;return e.addbtn(),e}return __extends(e,t),e.prototype.addbtn=function(){var t=egret.MainContext.instance.stage.stageWidth,e=egret.MainContext.instance.stage.stageHeight;data.createBtn("home_png",function(){data.updateData(),data.Game_Layer.parent.removeChild(data.Game_Layer);var t=new start;data.Main_Layer.addChild(t)},t/2-102,e/2+100,this),data.createBtn("again_png",function(){data.updateData(),data.Game_Layer.parent.removeChild(data.Game_Layer);var t=new game;data.Main_Layer.addChild(t)},t/2+102,e/2+100,this)},e}(egret.Sprite);__reflect(overAndMunu.prototype,"overAndMunu");var Rect=function(t){function e(e,a,r,i){var o=t.call(this)||this;return o._rect=[],o.rectType=["c1_png","c2_png","c3_png","c4_png","c5_png","c6_png"],o.Id=a,o.RotationId=i,o.TypeSprite(e,r,i),o}return __extends(e,t),e.prototype.TypeSprite=function(t,e,a){for(var r=0;r<data.typeArray[e][a].length;r++){var i=data.typeArray[e][a][r][0]*data.rect_width,o=data.typeArray[e][a][r][1]*data.rect_width;this.createRect(i,o,t,e,a)}},e.prototype.createRect=function(t,e,a,r,i){var o=this.rectType[a],n=new RectBool;n.texture=RES.getRes(o),this.addChild(n),n.COLOR=a,n.TYPE=r,n.ROTATIONTYPE=i,n.CANREMOVE=!1,n.x=t,n.y=e,n.ROW=0,n.COL=0,this._rect.push(n)},e}(egret.Sprite);__reflect(Rect.prototype,"Rect");var RectBool=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.CANREMOVE=!0,e.ROW=0,e.COL=0,e.COLOR=0,e.TYPE=0,e.ROTATIONTYPE=0,e}return __extends(e,t),e}(egret.Bitmap);__reflect(RectBool.prototype,"RectBool");var GroupRect=function(t){function e(){var e=t.call(this)||this;return e.RotationId=0,e.getid=0,e.ISCLICK=!1,e.rectType=["c1_png","c2_png","c3_png","c4_png","c5_png","c6_png"],data.Is_first&&data.readDateArray&&data.readDateArray.gameArray.down_game.length>0?(e.addSavedata(),data.Is_first=!1):e.createRects(),e}return __extends(e,t),e.prototype.createRects=function(){this._group=[];for(var t=0;3>t;t++){var e=Math.floor(6*Math.random()),a=Math.floor(15*Math.random());this.RotationId=0,this.createSprite(e,t,a,this.RotationId)}},e.prototype.onClickBegin=function(t){this.getid=t.currentTarget.Id,this.ISCLICK=!0},e.prototype.addSavedata=function(){this._group=[];for(var t=[],e=0;e<data.readDateArray.gameArray.down_game.length;e++){var a=data.readDateArray.gameArray.down_game[e][0].rect_color,r=data.readDateArray.gameArray.down_game[e][0].rect_type,i=data.readDateArray.gameArray.down_game[e][0].rect_rotationtype,o=data.readDateArray.gameArray.down_game[e][0].rect_CLICKNUM;this.createSprite(a,o,r,i),t.push(o)}for(var n=0;n<data.rect_num_Array.length;n++)-1==t.indexOf(data.rect_num_Array[n])&&(data.click_post[n].click=!1,data.rect_num_Array.splice(n,1),n--,data.CLICKNUM--)},e.prototype.createSprite=function(t,e,a,r){var i=new Rect(t,e,a,r);this._group[e]=i,this.addChild(i),i.scaleX=.5,i.scaleY=.5,i.x=data.DOWN_POSTION[e][0],i.y=1300,egret.Tween.get(i).to({x:data.DOWN_POSTION[e][0],y:data.DOWN_POSTION[e][1]},600,egret.Ease.backOut),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClickBegin,this)},e}(egret.Sprite);__reflect(GroupRect.prototype,"GroupRect");var rotationPanel=function(t){function e(){var e=t.call(this)||this;return e.getid=0,e.sp_Array=[],e.createPanel(),e}return __extends(e,t),e.prototype.createPanel=function(){var t=egret.MainContext.instance.stage.stageWidth,e=egret.MainContext.instance.stage.stageHeight;
this.touchEnabled=!0;var a=new egret.Sprite;a.graphics.beginFill(0,.5),a.graphics.drawRect(0,0,t,e),a.graphics.endFill(),this.addChild(a),this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("transform_bg_png"),this.addChild(this.bg),this.bg.x=egret.MainContext.instance.stage.stageWidth/2,this.bg.y=egret.MainContext.instance.stage.stageHeight-270,this.bg.anchorOffsetX=this.bg.width/2,this.bg.anchorOffsetY=this.bg.height/2,this.bg.scaleX=data.CLICKNUM/3,this.CreateSprite()},e.prototype.CreateSprite=function(){for(var t=this.bg.width*this.bg.scaleX,e=egret.MainContext.instance.stage.stageWidth/2-t/2,a=0;a<data.rect_num_Array.length;a++){var r=data.Game_Layer._GroupRect._group[data.rect_num_Array[a]]._rect[0].COLOR,i=data.Game_Layer._GroupRect._group[data.rect_num_Array[a]]._rect[0].TYPE,o=new Rect(r,data.rect_num_Array[a],i,0);this.addChild(o),o.scaleX=.5,o.scaleY=.5,o.x=e+t*a/data.rect_num_Array.length+100,o.y=this.bg.y,o.touchEnabled=!0,this.sp_Array.push(o),o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClickBegin,this)}},e.prototype.onClickBegin=function(t){this.CreateRotaSprite(t.currentTarget.Id)},e.prototype.CreateRotaSprite=function(t){for(var e=0;e<this.sp_Array.length;e++)this.sp_Array[e].parent.removeChild(this.sp_Array[e]),this.sp_Array.splice(e,1),e--;this.bg.scaleX=1;var a=egret.MainContext.instance.stage.stageWidth/2-this.bg.width/2,r=data.Game_Layer._GroupRect._group[t]._rect[0].COLOR,i=data.Game_Layer._GroupRect._group[t]._rect[0].TYPE;this.sp_Type=data.Game_Layer._GroupRect._group[t]._rect[0].TYPE;for(var o=data.Game_Layer._GroupRect._group[t]._rect[0].ROTATIONTYPE,n=0,s=0;4>s;s++)if(s!=o){var d=new Rect(r,t,i,s);this.addChild(d),d.scaleX=.5,d.scaleY=.5,d.x=a+this.bg.width*n/3+100,d.y=this.bg.y,d.touchEnabled=!0,this.sp_Array.push(d),d.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.swapSprite,this),n++}},e.prototype.swapSprite=function(t){for(var e=t.currentTarget.Id,a=t.currentTarget.RotationId,r=0;r<data.Game_Layer._GroupRect._group[e]._rect.length;r++)data.Game_Layer._GroupRect._group[e]._rect[r].x=data.typeArray[this.sp_Type][a][r][0]*data.rect_width,data.Game_Layer._GroupRect._group[e]._rect[r].y=data.typeArray[this.sp_Type][a][r][1]*data.rect_width;this.parent.removeChild(this)},e}(egret.Sprite);__reflect(rotationPanel.prototype,"rotationPanel");var start=function(t){function e(){var e=t.call(this)||this;return data.Start_Layer=e,e.CreateBg(),e}return __extends(e,t),e.prototype.CreateBg=function(){var t=new egret.Bitmap,e=RES.getRes("bg_cover_png");t.texture=e,this.addChild(t),t.x=egret.MainContext.instance.stage.stageWidth/2,t.y=egret.MainContext.instance.stage.stageHeight/2,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2;var a=egret.MainContext.instance.stage.stageWidth,r=egret.MainContext.instance.stage.stageHeight;data.createBtn("button_jdms_png",function(){data.Start_Layer.parent&&data.Start_Layer.parent.removeChild(data.Start_Layer),data.Start_Layer.sound1=RES.getRes("sound_del2_mp3"),data.Start_Layer.sound2=RES.getRes("sound_set2_mp3");var t=data.Start_Layer.sound1.play(0,1);t.stop();var e=data.Start_Layer.sound2.play(0,1);e.stop();var a=new game;data.Main_Layer.addChild(a)},a/2,r/2,this)},e.prototype.onLoadComplete=function(t){var e=t.target,a=e.data;this.sound1=a},e}(egret.Sprite);__reflect(start.prototype,"start");var TimerPanel=function(t){function e(){var e=t.call(this)||this;return e._num=3,e._timers=3,e.draw(),e.createTimer(),data.Timer_Layer=e,e}return __extends(e,t),e.prototype.draw=function(){this.txt=new egret.TextField,this.txt.width=egret.MainContext.instance.stage.stageWidth,this.txt.y=egret.MainContext.instance.stage.stageHeight/2,this.txt.textColor=16711680,this.txt.textAlign=egret.HorizontalAlign.CENTER,this.txt.bold=!0,this.txt.size=50,this.txt.text="3",this.addChild(this.txt)},e.prototype.createTimer=function(){this._timer=new egret.Timer(1e3,this._num),this._timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerCom,this)},e.prototype.onTimer=function(){this._timers-=1,this.txt.text=this._timers.toString()},e.prototype.onTimerCom=function(){this.txt.text=this._timers.toString(),data.Timer_Layer&&data.Timer_Layer.parent.removeChild(data.Timer_Layer);var t=new gameOver;data.Game_Layer.addChild(t),this.stop()},e.prototype.start=function(){this.txt.text="3",this._timers=3,this._timer.reset(),this._timer.start()},e.prototype.stop=function(){this.parent&&this.parent.removeChild(this),this._timer.stop()},e}(egret.Sprite);__reflect(TimerPanel.prototype,"TimerPanel");