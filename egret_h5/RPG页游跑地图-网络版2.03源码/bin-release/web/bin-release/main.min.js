var AStar=function(t){function e(e,i){void 0===i&&(i=1e4),t.call(this),this.isBalk=!1,this.COST_STRAIGHT=10,this.COST_DIAGONAL=20,this.COST_SWERVE=5,this.NOTE_ID=0,this.NOTE_OPEN=1,this.NOTE_CLOSED=2,this.m_openCount=0,this.m_openId=0,this.m_maxTry=0,this.m_Start=0,this.m_End=0,this.m_mapTileModel=e,this.m_maxTry=i}__extends(e,t);var i=__define,s=e,n=s.prototype;return i(n,"maxTry",function(){return this.m_maxTry},function(t){t=t,this.m_maxTry=t}),n.find=function(t,e,i,s){this.m_Start=egret.getTimer(),this.initLists(),this.m_openCount=0,this.m_openId=-1,this.openNote(t,e,0,0,0);for(var n,o=0,r=0,h=0,a=0,l=0,g=0,c=0,_=0,m=0;this.m_openCount>0;){if(this.m_End=egret.getTimer(),this.m_End-this.m_Start>this.m_maxTry)return this.destroyLists(),null;if(o=this.m_openList[0],this.closeNote(o),r=this.m_xList[o],h=this.m_yList[o],r==i&&h==s)return this.getPath(t,e,o);n=this.getArounds(r,h),a=this.m_fatherList[o],l=this.m_xList[a],g=this.m_yList[a];for(var d in n){var p=n[d];_=r-p[0]==h-p[1]?this.m_movementCostList[o]+this.COST_DIAGONAL:this.m_movementCostList[o]+this.COST_STRAIGHT,(r<<1!=l+p[0]||h<<1!=g+p[1])&&(_+=this.COST_SWERVE),m=_+(Math.abs(i-p[0])+Math.abs(s-p[1]))*this.COST_STRAIGHT,this.isOpen(p[0],p[1])?(c=this.m_noteMap[p[1]][p[0]][this.NOTE_ID],_<this.m_movementCostList[c]&&(this.m_movementCostList[c]=_,this.m_pathScoreList[c]=m,this.m_fatherList[c]=o,this.aheadNote(this.getIndex(c)))):this.openNote(p[0],p[1],m,_,o)}}return this.destroyLists(),null},n.openNote=function(t,e,i,s,n){this.m_openCount++,this.m_openId++,null==this.m_noteMap[e]&&(this.m_noteMap[e]=[]),this.m_noteMap[e][t]=[],this.m_noteMap[e][t][this.NOTE_OPEN]=!0,this.m_noteMap[e][t][this.NOTE_ID]=this.m_openId,this.m_xList.push(t),this.m_yList.push(e),this.m_pathScoreList.push(i),this.m_movementCostList.push(s),this.m_fatherList.push(n),this.m_openList.push(this.m_openId),this.aheadNote(this.m_openCount)},n.aheadNote=function(t){for(var e=0,i=0;t>1&&(e=Math.floor(t>>1),this.getScore(t)<this.getScore(e));)i=this.m_openList[t-1],this.m_openList[t-1]=this.m_openList[e-1],this.m_openList[e-1]=i,t=e},n.getScore=function(t){return this.m_pathScoreList[this.m_openList[t-1]]},n.initLists=function(){this.m_openList=[],this.m_xList=[],this.m_yList=[],this.m_pathScoreList=[],this.m_movementCostList=[],this.m_fatherList=[],this.m_noteMap=[]},n.destroyLists=function(){this.m_openList=null,this.m_xList=null,this.m_yList=null,this.m_pathScoreList=null,this.m_movementCostList=null,this.m_fatherList=null,this.m_noteMap=null},n.closeNote=function(t){this.m_openCount--;var e=this.m_xList[t],i=this.m_yList[t];return this.m_noteMap[i][e][this.NOTE_OPEN]=!1,this.m_noteMap[i][e][this.NOTE_CLOSED]=!0,this.m_openCount<=0?(this.m_openCount=0,void(this.m_openList=[])):(this.m_openList[0]=this.m_openList.pop(),void this.backNote())},n.backNote=function(){for(var t=1,e=0,i=0,s=0;;){if(e=t,i=e<<1,i<=this.m_openCount&&(this.getScore(t)>this.getScore(i)&&(t=i),i+1<=this.m_openCount&&this.getScore(t)>this.getScore(i+1)&&(t=i+1)),e==t)break;s=this.m_openList[e-1],this.m_openList[e-1]=this.m_openList[t-1],this.m_openList[t-1]=s}},n.getPath=function(t,e,i){for(var s=[],n=this.m_xList[i],o=this.m_yList[i];n!=t||o!=e;)s.unshift([n,o]),i=this.m_fatherList[i],n=this.m_xList[i],o=this.m_yList[i];return s.unshift([t,e]),this.destroyLists(),s},n.getArounds=function(t,e){var i=[],s=0,n=0;s=t+1,n=e;var o=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,n)!=Tile.PATH_BARRIER;o&&!this.isClosed(s,n)&&i.push([s,n]),s=t,n=e-1;var r=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,n)!=Tile.PATH_BARRIER;r&&!this.isClosed(s,n)&&i.push([s,n]),s=t-1,n=e;var h=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,n)!=Tile.PATH_BARRIER;h&&!this.isClosed(s,n)&&i.push([s,n]),s=t,n=e+1;var a=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,n)!=Tile.PATH_BARRIER;a&&!this.isClosed(s,n)&&i.push([s,n]),s=t+1,n=e+1;var l=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,n)!=Tile.PATH_BARRIER;l&&a&&o&&!this.isClosed(s,n)&&i.push([s,n]),s=t+1,n=e-1;var g=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,n)!=Tile.PATH_BARRIER;g&&r&&o&&!this.isClosed(s,n)&&i.push([s,n]),s=t-1,n=e-1;var c=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,n)!=Tile.PATH_BARRIER;c&&h&&r&&!this.isClosed(s,n)&&i.push([s,n]),s=t-1,n=e+1;var _=this.isBalk||this.m_mapTileModel.isBlock(t,e,s,n)!=Tile.PATH_BARRIER;return _&&h&&a&&!this.isClosed(s,n)&&i.push([s,n]),i},n.isClosed=function(t,e){return null==this.m_noteMap[e]?!1:null==this.m_noteMap[e][t]?!1:this.m_noteMap[e][t][this.NOTE_CLOSED]},n.isOpen=function(t,e){return null==this.m_noteMap[e]?!1:null==this.m_noteMap[e][t]?!1:this.m_noteMap[e][t][this.NOTE_OPEN]},n.getIndex=function(t){var e=1;for(var i in this.m_openList){var s=this.m_openList[i];if(s==t)return e;e++}return-1},e}(egret.HashObject);egret.registerClass(AStar,"AStar");var Tile=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.dispose=function(){this.data=null},s.isBlock=function(t,i,s,n){var o=this.data.length,r=this.data[0].length;return 0>s||s>=o||0>n||n>=r?e.PATH_UNKNOWN:this.data[s][n]},s.getTargetTile=function(t,e){return this.isBlock(0,0,t,e)},s.isPass=function(t,i){var s=this.data.length,n=this.data[0].length;return 0>t||t>=s||0>i||i>=n?!1:this.data[t][i]!=e.PATH_BARRIER?!0:!1},s.isPassPoint=function(t){return this.isPass(t.x,t.y)},s.isPassAToB=function(t,i,s,n,o){for(var r=new egret.Point(t,i),h=new egret.Point(s,n),a=egret.Point.distance(r,h),l=this.moveIncrement(r,h,o),g=0;a>g;){r=r.add(l),g+=o;var c=e.getTileStageToPoint(r.x,r.y);if(0==this.isPass(c.x,c.y))return!1}return!0},s.moveIncrement=function(t,e,i){var s=egret.Point.distance(t,e),n=i/s,o=(e.x-t.x)*n,r=(e.y-t.y)*n;return new egret.Point(o,r)},e.getNextPos=function(t,i,s){var n=new egret.Point;return n.x=t+e.DELTA_X[s],n.y=i+e.DELTA_Y[s],n},e.getTileStageToPoint=function(t,i){var s=t-2*i;0>s&&(s-=e.TILE_WIDTH);var n=2*i+t,o=(n+e.TITE_HALF_WIDTH)/e.TILE_WIDTH,r=(s+e.TITE_HALF_WIDTH)/e.TILE_WIDTH;return new egret.Point(e.OFFSET_TAB_X+o,e.OFFSET_TAB_Y+r)},e.getTilePointToStage=function(t,i){var s=new egret.Point,n=t-e.OFFSET_TAB_X,o=i-e.OFFSET_TAB_Y;return s.x=n*e.TITE_HALF_WIDTH+o*e.TITE_HALF_WIDTH,s.y=n*e.TITE_HALF_HEIGHT-o*e.TITE_HALF_HEIGHT,s},e.getTileStageToPointByOffset=function(t,i,s,n){var o=t-2*i;0>o&&(o-=e.TILE_WIDTH);var r=2*i+t,h=(r+e.TITE_HALF_WIDTH)/e.TILE_WIDTH,a=(o+e.TITE_HALF_WIDTH)/e.TILE_WIDTH;return new egret.Point(s+h,n+a)},e.getTilePointToStageByOffset=function(t,i,s,n){var o=new egret.Point,r=t-s,h=i-n;return o.x=r*e.TITE_HALF_WIDTH+h*e.TITE_HALF_WIDTH,o.y=r*e.TITE_HALF_HEIGHT-h*e.TITE_HALF_HEIGHT,o},e.createMapData=function(t,e,i,s){for(var n=new Array,o=t%i==0?t/i:t/i+1,r=e%s==0?e/s:e/s+1,h=0;o>h;h++){n[h]=new Array;for(var a=0;r>a;a++)n[h][2*a]=0,n[h][2*a+1]=0}return n},e.distance=function(t,e,i,s){var n=Math.abs(t-i),o=Math.abs(e-s);return Math.max(n,o)},e.direction=function(t,e,i,s){return i>t?s>e?6:e>s?2:3:t>i?s>e?8:e>s?4:7:s>e?9:e>s?1:0},e.PATH_UNKNOWN=-1,e.PATH_PASS=0,e.PATH_BARRIER=1,e.PATH_TRANSLUCENCE=2,e.PATH_CLOSED_AREAS=3,e.OFFSET_TAB_X=0,e.OFFSET_TAB_Y=0,e.TILE_WIDTH=0,e.TILE_HEIGHT=0,e.TITE_HALF_WIDTH=0,e.TITE_HALF_HEIGHT=0,e.DELTA_X=[0,0,1,1,-1,0,1,-1,-1,0,0],e.DELTA_Y=[0,-1,-1,0,-1,0,1,0,1,1,0],e}(egret.HashObject);egret.registerClass(Tile,"Tile",["ITile"]);var GameLayer=function(t){function e(){t.call(this),this.stageW=0,this.stageH=0,this.scX=0,this.scY=0,this.downPoint=new egret.Point,this.speedX=0,this.speedY=0,this.center=new egret.Shape,this.textField=new egret.TextField,this.onGrid=new egret.Point,this.inGrid=new egret.Point,this.tile_a=new Tile,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.init,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this);var t=new egret.Shape;t.graphics.beginFill(3368601),t.graphics.drawRoundRect(0,0,this.stageW,this.stageH,3,3),t.graphics.endFill(),this.addChild(t),e.gameScene=new GameScene,this.addChild(e.gameScene),e.gameScene.addEventListener("mapOk",this.onSceneEvent,this),this.textField.touchEnabled=!0,this.textField.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tapHandler,this),this.textField.size=22,this.textField.x=this.stageW/2,this.textField.y=0,this.textField.width=this.stageW/2,this.textField.height=90,this.textField.textColor=16777215,this.textField.textAlign="center",this.textField.text="期待QQ:8X4X7X7X8",this.addChild(this.textField),e.gameScene.addEventListener("mapLoadOk",this.onSceneEvent,this)},s.moveScene=function(t,i,s){e.gameScene.mapOk(t,i,s)},s.onSceneEvent=function(t){if("mapLoadOk"==t.type){e.gameScene.removeEventListener("mapLoadOk",this.onSceneEvent,this),this.mapPoint=new MapPoint,this.tile_a.data=MapLoad.sceneArray,Tile.OFFSET_TAB_Y=MapLoad.offsetY,Tile.TILE_WIDTH=MapLoad.tileWidth,Tile.TILE_HEIGHT=MapLoad.tileHeight,Tile.TITE_HALF_WIDTH=MapLoad.tileWidth/2,Tile.TITE_HALF_HEIGHT=MapLoad.tileWidth/2,this.aStar_a=new AStar(this.tile_a,100);var i=this.mapPoint.Point_b(66,88);this.movePoint(i.x,i.y),i=this.mapPoint.Point_a(this.scX,this.scY),this.scX=i.x,this.scY=i.y,i=this.mapPoint.Point_c(this.scX,this.scY),this.onGrid.x=i.x,this.onGrid.y=i.y,this.textField.text="点击这里开关网格\n期待QQ:8X4X7X7X8\n地图坐标 x:"+this.scX+" y:"+this.scY+"\n格子坐标 x:"+i.x+" y:"+i.y,e.gameScene.x=-this.scX,e.gameScene.y=-this.scY;var s=[];e.gameScene.mapOk(this.scX,this.scY,s),this.center.x=this.width/2,this.center.y=this.height/2,e.gameScene.setHeroPoint(this.scX,this.scY),i=this.mapPoint.Point_b(70,82),i.x-=this.stageW/2,i.y-=this.stageH/2,e.gameScene.setMonster(1,i.x,i.y),i=this.mapPoint.Point_b(70,87),i.x-=this.stageW/2,i.y-=this.stageH/2,e.gameScene.setMonster(2,i.x,i.y),i=this.mapPoint.Point_b(76,86),i.x-=this.stageW/2,i.y-=this.stageH/2,e.gameScene.setMonster(3,i.x,i.y),i=this.mapPoint.Point_b(73,93),i.x-=this.stageW/2,i.y-=this.stageH/2,e.gameScene.setMonster(4,i.x,i.y),i=this.mapPoint.Point_b(60,102),i.x-=this.stageW/2,i.y-=this.stageH/2,e.gameScene.setMonster(5,i.x,i.y),i=this.mapPoint.Point_b(72,75),i.x-=this.stageW/2,i.y-=this.stageH/2,e.gameScene.setMonster(6,i.x,i.y),i=this.mapPoint.Point_b(82,68),i.x-=this.stageW/2,i.y-=this.stageH/2,e.gameScene.setMonster(7,i.x,i.y),i=this.mapPoint.Point_b(88,79),i.x-=this.stageW/2,i.y-=this.stageH/2,e.gameScene.setMonster(8,i.x,i.y)}},s.onTouch=function(t){var i=e.gameScene.reMoveTw();if(this.scX=i.x,this.scY=i.y,i=this.mapPoint.Point_c(this.scX,this.scY),this.onGrid.x=i.x,this.onGrid.y=i.y,this.movePoint(t.stageX,t.stageY),i=this.mapPoint.Point_a(this.scX,this.scY),this.scX=i.x,this.scY=i.y,-5==this.scY&&(this.scY=5),10==this.scY&&(this.scY=-10),-5==this.scX&&(this.scX=5),10==this.scX&&(this.scX=-10),i=this.mapPoint.Point_c(this.scX,this.scY),this.inGrid.x=i.x,this.inGrid.y=i.y,this.textField.text="点击这里开关网格线\n期待QQ:8X4X7X7X8\n地图坐标 x:"+this.scX+" y:"+this.scY+"\n格子坐标 x:"+i.x+" y:"+i.y,this.onGrid.x==this.inGrid.x&&this.onGrid.y==this.inGrid.y);else{var s=this.aStar_a.find(this.onGrid.x,this.onGrid.y,this.inGrid.x,this.inGrid.y),n=[],o="";if(s)for(var r=0,h=s.length;h>r;r++){var a=new egret.Point;a.x=s[r][0],a.y=s[r][1],n.push(a),r==h-1?(o+=a.x+",",o+=a.y):(o+=a.x+",",o+=a.y+"|")}this.moveScene(this.scX,this.scY,n);var l=MsgType.msgB_a+"#"+i.x+","+i.y+"#"+this.scX+","+this.scY+"#"+o;this.pushMsg(l)}},s.pushMsg=function(t){NetMsg.isConnection&&NetMsg.serverConn.sendData(t)},s.movePoint=function(t,e){this.stageW=egret.MainContext.instance.stage.stageWidth,this.stageH=egret.MainContext.instance.stage.stageHeight;var i=this.stageW/2,s=this.stageH/2,n=Math.abs(t-i),o=Math.abs(e-s);n&&o&&(this.speedX=n,this.speedY=o),this.downPoint.x=t,this.downPoint.y=e;var r=Math.atan2(this.downPoint.y-s,this.downPoint.x-i),h=180*r/Math.PI,a=this.FangXiang(h);this.tiaozheng(a,h)},s.FangXiang=function(t){var e=1;return 20>=t&&t>=-20?e=1:110>=t&&t>=70?e=2:-170>=t||t>=170?e=3:-70>=t&&t>=-110?e=4:70>t&&t>20?e=5:170>t&&t>110?e=6:-110>t&&t>-170?e=7:-20>t&&t>-70&&(e=8),e},s.tiaozheng=function(t,e){switch(t){case 1:this.scX+=this.speedX,e>0?this.scY+=this.speedY:0>e&&(this.scY-=this.speedY);break;case 2:90>e?this.scX+=this.speedX:e>90&&(this.scX-=this.speedX),this.scY+=this.speedY;break;case 3:this.scX-=this.speedX,e>0?this.scY+=this.speedY:0>e&&(this.scY-=this.speedY);break;case 4:e>-90?this.scX+=this.speedX:-90>e&&(this.scX-=this.speedX),this.scY-=this.speedY;break;case 5:this.scX+=this.speedX,this.scY+=this.speedY;break;case 6:this.scX-=this.speedX,this.scY+=this.speedY;break;case 7:this.scX-=this.speedX,this.scY-=this.speedY;break;case 8:this.scX+=this.speedX,this.scY-=this.speedY}},s.tapHandler=function(t){e.gameScene.setLine(),e.gameScene.setPo()},e}(egret.DisplayObjectContainer);egret.registerClass(GameLayer,"GameLayer");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},s.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.call(this),this.netMsg=new NetMsg,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},s.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},s.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},s.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},s.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},s.createGameScene=function(){this.gameLayer=new GameLayer,this.stage.addChild(this.gameLayer)},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var MapLoad=function(t){function e(){t.call(this),this.mapsElement=[],this.isMusic=!0,this.init()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.onMusic(),RES.getResAsync("1001_json",this.onRes,this)},s.onRes=function(t){for(var i=0,s=t.length;s>i;i++){var n=t[i];e.mapName=n.MapName,e.mapWidth=parseInt(n.MapWidth),e.mapHeight=parseInt(n.MapHeight),e.imgWH=parseInt(n.imgWH),e.tileWidth=parseInt(n.TileWidth),e.tileHeight=parseInt(n.TileHeight),e.row=parseInt(n.Row),e.offsetY=parseInt(n.OffsetY);var o=n.ScenePoint;console.log(o),console.log(e.mapName+"|"+e.mapWidth+"|"+e.mapHeight+"|"+e.imgWH),console.log(e.tileWidth+"|"+e.tileHeight+"|"+e.row+"|"+e.offsetY);var r=Math.floor(e.mapWidth/e.imgWH)-1,h=Math.floor(e.mapHeight/e.imgWH)-1;console.log(r+"  "+h);for(var a=new Array,l=o.split(","),g=0,c=0;c<e.row;c++){a[c]=new Array;for(var _=0;_<e.row;_++)a[c][_]=l[g],g+=1}console.log(a.length),console.log(a[12][118]),console.log(a[13][118]),console.log(a[14][118]),e.sceneArray=a,this.Scene(e.mapName,r,h,e.imgWH)}},s.Scene=function(t,e,i,s){for(var n,o=0;e>=o;o++)for(var r=0;i>=r;r++)n=new imgName,n.name=o+"_"+r,n.x=o*s,n.y=r*s,this.mapsElement.push(n);this.dispatchEvent(new egret.Event("LoadOk"))},s.onMap=function(t,e){RES.getResByUrl("resource/assets/map/1001/"+t.name+".jpg",function(i){var s=i,n=new egret.Bitmap(s);n.x=t.x,n.y=t.y,t.mapsElement=n,t.isLoad=!0,e&&e.addChild(n)},this,RES.ResourceItem.TYPE_IMAGE)},s.playMusic=function(){this.isMusic&&this.BgSound&&this.BgSound.isOk&&(this.BgSound.playSound(),console.log("播放"),this.isMusic=!1)},s.onMusic=function(){var t=new Nmd;this.BgSound=t,RES.getResByUrl("resource/assets/map/1001/sound.mp3",function(e){var i=e;t.setTmd_a(i)},this,RES.ResourceItem.TYPE_SOUND)},e.mapName="",e.mapWidth=0,e.mapHeight=0,e.imgWH=0,e.tileWidth=0,e.tileHeight=0,e.row=0,e.offsetY=0,e.sceneArray=new Array,e}(egret.Shape);egret.registerClass(MapLoad,"MapLoad");var MapPoint=function(){function t(){this.mapHeight=MapLoad.mapHeight,this.gridWidth=MapLoad.tileWidth,this.gridHeight=MapLoad.tileHeight}var e=(__define,t),i=e.prototype;return i.mPoint=function(t,e,i){var s=new egret.Point,n=this.gridWidth,o=this.gridHeight,r=t+n,h=e+o/2,a=h+r/2,l=Math.floor(a/o-1),g=r-2*h,c=Math.floor(g/n+i);return s.x=l,s.y=c,s},i.gPoint=function(t,e,i){var s=new egret.Point,n=this.gridHeight,o=n/2;return s.x=n*(t-(i-e)),s.y=o*(t+i-e),s},i.Point_a=function(t,e){return this.Point_a_a(t,e)},i.Point_a_a=function(t,e){var i,s=egret.MainContext.instance.stage.stageWidth/2,n=egret.MainContext.instance.stage.stageHeight/2,o=Math.abs(t+s),r=Math.abs(e+n),h=Math.floor(this.mapHeight/this.gridHeight);return i=this.mPoint(o,r,h),i=this.gPoint(i.x,i.y,h),o=Math.abs(i.x-s),r=Math.abs(i.y-n),0>t?i.x=-o:i.x=o,0>e?i.y=-r:i.y=r,i},i.Point_b=function(t,e){return this.Point_b_a(t,e)},i.Point_b_a=function(t,e){var i=(egret.MainContext.instance.stage.stageWidth/2,egret.MainContext.instance.stage.stageHeight/2,Math.floor(this.mapHeight/this.gridHeight)),s=new egret.Point;s.x=t,s.y=e,s=this.gPoint(s.x,s.y,i);var n=new egret.Point,o=t-Tile.OFFSET_TAB_X,r=e-Tile.OFFSET_TAB_Y;return n.x=o*Tile.TITE_HALF_WIDTH+r*Tile.TITE_HALF_WIDTH,n.y=o*Tile.TITE_HALF_HEIGHT-r*Tile.TITE_HALF_HEIGHT,n.x=n.x,n.y=n.y/2,n},i.Point_c=function(t,e){return this.Point_c_a(t,e)},i.Point_c_a=function(t,e){var i,s=egret.MainContext.instance.stage.stageWidth/2,n=egret.MainContext.instance.stage.stageHeight/2,o=Math.abs(t+s),r=Math.abs(e+n),h=Math.floor(this.mapHeight/this.gridHeight);return i=this.mPoint(o,r,h)},t}();egret.registerClass(MapPoint,"MapPoint");var DateEvent=function(t){function e(e,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1),t.call(this,e,i,s),this.testTxt=""}__extends(e,t);var i=(__define,e);i.prototype;return e.DATE="内容",e}(egret.Event);egret.registerClass(DateEvent,"DateEvent");var Connection=function(t){function e(){t.call(this),this.isConnection=!1}__extends(e,t);var i=(__define,e),s=i.prototype;return s.Connection=function(t,e){return this.isConnection?void this.messageEvent(MsgType.msgA+"&"+MsgType.msgA_c):(this.webSocket=new egret.WebSocket,this.webSocket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.webSocket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),void this.webSocket.connect(t,e))},s.onSocketOpen=function(){this.isConnection=!0,this.messageEvent(MsgType.msgA+"&"+MsgType.msgA_a)},s.onReceiveMessage=function(t){var e=this.webSocket.readUTF();this.messageEvent(MsgType.msgB+"&"+e)},s.sendData=function(t){return this.isConnection?(this.webSocket.writeUTF(t),void this.webSocket.flush()):void this.messageEvent(MsgType.msgA+"&"+MsgType.msgA_b)},s.messageEvent=function(t){var e=new DateEvent(DateEvent.DATE);e.testTxt=t,this.dispatchEvent(e)},e}(egret.Sprite);egret.registerClass(Connection,"Connection");var MsgType=function(){function t(){}var e=(__define,t);e.prototype;return t.msgA="0",t.msgB="1",t.msgC="2",t.msgD="3",t.msgA_a="0",t.msgA_b="1",t.msgA_c="2",t.msgB_a="0",t}();egret.registerClass(MsgType,"MsgType");var NetMsg=function(){function t(){this.init()}var e=(__define,t),i=e.prototype;return i.init=function(){t.serverConn.Connection("echo.websocket.org",80),t.serverConn.addEventListener(DateEvent.DATE,this.getDate,this)},i.getDate=function(t){var e=t.testTxt,i=(new Array,e.split("&"));if(!(i.length<1)){var s=i[0];switch(e=i[1],s){case MsgType.msgA:console.log(e),this.msgState(e);break;case MsgType.msgB:this.msgContent(e)}}},i.msgState=function(e){switch(console.warn("状态消息："+e),e){case MsgType.msgA_a:t.isConnection=!0,console.log("状态："+e),this.pushMsg("Hello, world！");break;case MsgType.msgA_b:console.log("状态："+e);break;case MsgType.msgA_c:console.log("状态："+e)}},i.msgContent=function(t){var e=t.split("#");if(!(e.length<4))switch(e[0]){case MsgType.msgB_a:var i=new egret.Point,s=new egret.Point,n=[],o=e[1].split(",");o.length>1&&(i.x=parseInt(o[0]),i.y=parseInt(o[1])),o=e[2].split(","),o.length>1&&(s.x=parseInt(o[0]),s.y=parseInt(o[1])),o=e[3].split("|");for(var r=0;r<o.length;r++){var h=o[r].split(",");if(h.length>1){var a=new egret.Point;a.x=parseInt(h[0]),a.y=parseInt(h[1]),n.push(a)}}}},i.pushMsg=function(e){t.isConnection&&t.serverConn.sendData(e)},t.serverConn=new Connection,t.isConnection=!1,t}();egret.registerClass(NetMsg,"NetMsg");var Nmd=function(){function t(){this.BgSound=new egret.Sound,this.isOk=!1,this.isPlay=!0}var e=(__define,t),i=e.prototype;return i.setTmd_a=function(t){this.BgSound=t,this.BgMusic=this.BgSound.play(),this.isOk=!0},i.getTmd_a=function(){return this.BgSound},i.playSound=function(){this.BgMusic||(this.BgMusic=this.BgSound.play())},t}();egret.registerClass(Nmd,"Nmd");var Hero=function(t){function e(){t.call(this),this.resPlayer=new ResPlayer,this.stageW=0,this.stageH=0,this.out_x=0,this.out_y=0,this.center=new egret.Shape,this.context=new egret.Sprite,this.fx=6,this.fx_a=0,this.fo="0",this.isAlpha=!1,this.GameFrame=new egret.Timer(200),this.hero_r_png=new egret.Bitmap,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.init,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,RoleConstant.role||this.startG()},s.startG=function(){var t=new egret.Bitmap;t.texture=RES.getRes("hero_y_png"),t.anchorOffsetX=t.width/2-3,t.anchorOffsetY=t.height/2+3,this.context.addChild(t),this.hero_r_png.texture=RES.getRes("hero_r_png"),this.hero_r_png.anchorOffsetX=this.hero_r_png.width/2-3,this.hero_r_png.anchorOffsetY=this.hero_r_png.height-8,this.context.addChild(this.hero_r_png),this.onPlayer("Player103","1003","1003","0_3"),this.addChild(this.context),this.GameFrame.addEventListener(egret.TimerEvent.TIMER,this.onGameFrame,this)},s.onPlayer=function(t,e,i,s){this.resPlayer.onAddToStage(t,e,i,s),this.resPlayer.addEventListener(t,this.gameStart,this)},s.gameStart=function(t){console.log("tt"+t.type),"Player103"==t.type&&(RoleConstant.rolePool.playerPool="Player103",RoleConstant.rolePool.j_josn="1003",RoleConstant.rolePool.t_texture="1003",RoleConstant.rolePool.n_name="0_3",this.createPlayer103())},s.createPlayer103=function(){RoleConstant.role=RoleConstant.rolePool.getRole(6,6),RoleConstant.rolePool.key=1,this.context.addChild(RoleConstant.role),this.hero_r_png.parent&&this.hero_r_png.parent.removeChild(this.hero_r_png)},s.moveHero=function(t,e,i){this.out_x=t,this.out_y=e,i.length>2&&i.shift();egret.MainContext.instance.stage.stageWidth/2,egret.MainContext.instance.stage.stageHeight/2;this.tw=egret.Tween.get(this.context);var s=new egret.Point;s.x=0,s.y=0;for(var n,o=0,r=MapLoad.tileHeight,h=200,a=0,l="",g=0,c=i.length;c>g;g++){n=Tile.getTilePointToStage(i[g].x,i[g].y),n.y=n.y/2,o=this.distance(s.x,s.y,n.x,n.y),a=o>r?2*h:h;var _=0,m=0,d=0;if(0==g){s=i.length>1?Tile.getTilePointToStage(i[1].x,i[1].y):Tile.getTilePointToStage(i[0].x,i[0].y),s.y=s.y/2;var p=Math.atan2(s.y-this.context.y,s.x-this.context.x);d=180*p/Math.PI,this.y==n.y&&this.x==n.x||(20>=d&&d>=-20?m=1:110>=d&&d>=70?m=2:-170>=d||d>=170?m=3:-70>=d&&d>=-110?m=4:70>d&&d>20?m=5:170>d&&d>110?m=6:-110>d&&d>-170?m=7:-20>d&&d>-70&&(m=8),this.fx=m),this.tiaozheng(11),this.GameFrame.start()}var u=new Tmd;this.tmd=u,this.tw.to({x:n.x,y:n.y},a).call(function(){c-1>_&&(_+=1),l=MapLoad.sceneArray[i[_].x][i[_].y],u.setTmd_b(l),s=Tile.getTilePointToStage(i[_].x,i[_].y),s.y=s.y/2;var t=Math.atan2(s.y-this.y,s.x-this.x);d=180*t/Math.PI,this.y==s.y&&this.x==s.x||(20>=d&&d>=-20?m=1:110>=d&&d>=70?m=2:-170>=d||d>=170?m=3:-70>=d&&d>=-110?m=4:70>d&&d>20?m=5:170>d&&d>110?m=6:-110>d&&d>-170?m=7:-20>d&&d>-70&&(m=8),u.setTmd_a(m))}),s.x=n.x,s.y=n.y}},s.reMoveTw=function(){this.tw&&(this.tw.pause,this.tw=new egret.Tween.removeTweens(this.context));var t=egret.MainContext.instance.stage.stageWidth/2,e=egret.MainContext.instance.stage.stageHeight/2,i=new egret.Point;return this.out_x<0?(i.x=-Math.abs(this.context.x),i.x=-i.x-t):(i.x=Math.abs(this.context.x),i.x=i.x-t),this.out_y<0?(i.y=-Math.abs(this.context.y),i.y=-i.y-e):(i.y=Math.abs(this.context.y),i.y=i.y-e),this.GameFrame.stop(),this.tiaozheng(6),this.fx_a=0,i},s.distance=function(t,e,i,s){var n=Math.abs(t-i),o=Math.abs(e-s);return Math.max(n,o)},s.setHeroPoint=function(t,e){var i=egret.MainContext.instance.stage.stageWidth/2,s=egret.MainContext.instance.stage.stageHeight/2;t+=i,e+=s,this.context.x=t,this.context.y=e},s.getHeroPoint=function(){var t=new egret.Point;return t.x=this.context.x-240,t.y=this.context.y-400,t},s.tiaozheng=function(t){switch(RoleConstant.role&&RoleConstant.role.parent&&(RoleConstant.role.isTimer(!1),RoleConstant.role.parent.removeChild(RoleConstant.role)),this.fx){case 1:t+=2,RoleConstant.role=RoleConstant.rolePool.getRole(t,t),RoleConstant.role.scaleX=-1;break;case 2:RoleConstant.role=RoleConstant.rolePool.getRole(t,t),RoleConstant.role.scaleX=1;break;case 3:t+=2,RoleConstant.role=RoleConstant.rolePool.getRole(t,t),RoleConstant.role.scaleX=1;break;case 4:t+=4,RoleConstant.role=RoleConstant.rolePool.getRole(t,t),RoleConstant.role.scaleX=1;break;case 5:t+=1,RoleConstant.role=RoleConstant.rolePool.getRole(t,t),RoleConstant.role.scaleX=-1;break;case 6:t+=1,RoleConstant.role=RoleConstant.rolePool.getRole(t,t),RoleConstant.role.scaleX=1;break;case 7:t+=3,RoleConstant.role=RoleConstant.rolePool.getRole(t,t),RoleConstant.role.scaleX=1;break;case 8:t+=3,RoleConstant.role=RoleConstant.rolePool.getRole(t,t),RoleConstant.role.scaleX=-1}this.context.addChild(RoleConstant.role)},s.onGameFrame=function(t){this.fx=this.tmd.getTmd_a(),this.fo=this.tmd.getTmd_b();var e=egret.MainContext.instance.stage.stageWidth/2,i=egret.MainContext.instance.stage.stageHeight/2,s=Math.floor(this.context.x-e),n=Math.floor(this.context.y-i),o=Math.abs(s-this.out_x),r=Math.abs(n-this.out_y),h=2;h>o&&h>r?(this.GameFrame.stop(),this.tiaozheng(6),this.fx_a=0):this.fx!=this.fx_a&&(this.tiaozheng(11),this.fx_a=this.fx),"2"==this.fo?(this.isAlpha=!0,this.context.alpha=.5):1==this.isAlpha&&(this.isAlpha=!1,this.context.alpha=1)},e}(egret.DisplayObjectContainer);egret.registerClass(Hero,"Hero");var Monster=function(t){function e(){t.call(this),this.resPlayer=new ResPlayer,this.stageW=0,this.stageH=0,this.out_x=0,this.out_y=0,this.center=new egret.Shape,this.context=new egret.Sprite,this.fx=6,this.fx_a=0,this.fo="0",this.isAlpha=!1,this.GameFrame=new egret.Timer(200),this.hero_r_png=new egret.Bitmap,this.Hero_mo=new RoleType,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.init,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.Hero_mo.role||this.startG()},s.startG=function(){var t=new egret.Bitmap;t.texture=RES.getRes("hero_y_png"),t.anchorOffsetX=t.width/2-3,t.anchorOffsetY=t.height/2+3,this.context.addChild(t),this.hero_r_png.texture=RES.getRes("hero_r_png"),this.hero_r_png.anchorOffsetX=this.hero_r_png.width/2-3,this.hero_r_png.anchorOffsetY=this.hero_r_png.height-8,this.context.addChild(this.hero_r_png),console.log("lll"),this.resMonster("Player103","1003","1003","0_3"),this.addChild(this.context),this.GameFrame.addEventListener(egret.TimerEvent.TIMER,this.onGameFrame,this)},s.resMonster=function(t,e,i,s){this.resPlayer.onAddToStage(t,e,i,s),this.resPlayer.addEventListener(t,this.onMonster,this)},s.onMonster=function(t){console.log("tt"+t.type),"Player103"==t.type&&(this.Hero_mo.rolePool.playerPool="Player103",this.Hero_mo.rolePool.j_josn="1003",this.Hero_mo.rolePool.t_texture="1003",this.Hero_mo.rolePool.n_name="0_3",this.createMonster())},s.createMonster=function(){this.Hero_mo.role=this.Hero_mo.rolePool.getRole(6,6),this.Hero_mo.rolePool.key=2,this.context.addChild(this.Hero_mo.role),this.hero_r_png.parent&&this.hero_r_png.parent.removeChild(this.hero_r_png)},s.moveHero=function(t,e,i){this.out_x=t,this.out_y=e,i.length>2&&i.shift();egret.MainContext.instance.stage.stageWidth/2,egret.MainContext.instance.stage.stageHeight/2;this.tw=egret.Tween.get(this.context);var s=new egret.Point;s.x=0,s.y=0;for(var n,o=0,r=MapLoad.tileHeight,h=200,a=0,l="",g=0,c=i.length;c>g;g++){n=Tile.getTilePointToStage(i[g].x,i[g].y),n.y=n.y/2,o=this.distance(s.x,s.y,n.x,n.y),a=o>r?2*h:h;var _=0,m=0,d=0;if(0==g){s=i.length>1?Tile.getTilePointToStage(i[1].x,i[1].y):Tile.getTilePointToStage(i[0].x,i[0].y),s.y=s.y/2;var p=Math.atan2(s.y-this.context.y,s.x-this.context.x);d=180*p/Math.PI,this.y==n.y&&this.x==n.x||(20>=d&&d>=-20?m=1:110>=d&&d>=70?m=2:-170>=d||d>=170?m=3:-70>=d&&d>=-110?m=4:70>d&&d>20?m=5:170>d&&d>110?m=6:-110>d&&d>-170?m=7:-20>d&&d>-70&&(m=8),this.fx=m),this.tiaozheng(11),this.GameFrame.start()}var u=new Tmd;this.tmd=u,this.tw.to({x:n.x,y:n.y},a).call(function(){c-1>_&&(_+=1),l=MapLoad.sceneArray[i[_].x][i[_].y],u.setTmd_b(l),s=Tile.getTilePointToStage(i[_].x,i[_].y),s.y=s.y/2;var t=Math.atan2(s.y-this.y,s.x-this.x);d=180*t/Math.PI,this.y==s.y&&this.x==s.x||(20>=d&&d>=-20?m=1:110>=d&&d>=70?m=2:-170>=d||d>=170?m=3:-70>=d&&d>=-110?m=4:70>d&&d>20?m=5:170>d&&d>110?m=6:-110>d&&d>-170?m=7:-20>d&&d>-70&&(m=8),u.setTmd_a(m))}),s.x=n.x,s.y=n.y}},s.reMoveTw=function(){this.tw&&(this.tw.pause,this.tw=new egret.Tween.removeTweens(this.context));var t=egret.MainContext.instance.stage.stageWidth/2,e=egret.MainContext.instance.stage.stageHeight/2,i=new egret.Point;return this.out_x<0?(i.x=-Math.abs(this.context.x),i.x=-i.x-t):(i.x=Math.abs(this.context.x),i.x=i.x-t),this.out_y<0?(i.y=-Math.abs(this.context.y),i.y=-i.y-e):(i.y=Math.abs(this.context.y),i.y=i.y-e),this.GameFrame.stop(),this.tiaozheng(6),this.fx_a=0,i},s.distance=function(t,e,i,s){var n=Math.abs(t-i),o=Math.abs(e-s);return Math.max(n,o)},s.setHeroPoint=function(t,e){var i=egret.MainContext.instance.stage.stageWidth/2,s=egret.MainContext.instance.stage.stageHeight/2;t+=i,e+=s,this.context.x=t,this.context.y=e},s.getHeroPoint=function(){var t=new egret.Point;return t.x=this.context.x-240,t.y=this.context.y-400,t},s.isTimer=function(t){this.Hero_mo.role&&this.Hero_mo.role.isTimer(t)},s.tiaozheng=function(t){switch(this.Hero_mo.role&&this.Hero_mo.role.parent&&(this.Hero_mo.role.isTimer(!1),this.Hero_mo.role.parent.removeChild(this.Hero_mo.role)),this.fx){case 1:t+=2,this.Hero_mo.role=this.Hero_mo.rolePool.getRole(t,t),this.Hero_mo.role.scaleX=-1;break;case 2:this.Hero_mo.role=this.Hero_mo.rolePool.getRole(t,t),this.Hero_mo.role.scaleX=1;break;case 3:t+=2,this.Hero_mo.role=this.Hero_mo.rolePool.getRole(t,t),this.Hero_mo.role.scaleX=1;break;case 4:t+=4,this.Hero_mo.role=this.Hero_mo.rolePool.getRole(t,t),this.Hero_mo.role.scaleX=1;break;case 5:t+=1,this.Hero_mo.role=this.Hero_mo.rolePool.getRole(t,t),this.Hero_mo.role.scaleX=-1;break;case 6:t+=1,this.Hero_mo.role=this.Hero_mo.rolePool.getRole(t,t),this.Hero_mo.role.scaleX=1;break;case 7:t+=3,this.Hero_mo.role=this.Hero_mo.rolePool.getRole(t,t),this.Hero_mo.role.scaleX=1;break;case 8:t+=3,this.Hero_mo.role=this.Hero_mo.rolePool.getRole(t,t),this.Hero_mo.role.scaleX=-1
}this.context.addChild(this.Hero_mo.role)},s.onGameFrame=function(t){this.fx=this.tmd.getTmd_a(),this.fo=this.tmd.getTmd_b();var e=egret.MainContext.instance.stage.stageWidth/2,i=egret.MainContext.instance.stage.stageHeight/2,s=Math.floor(this.context.x-e),n=Math.floor(this.context.y-i);s==this.out_x&&n==this.out_y?(this.GameFrame.stop(),this.tiaozheng(6),this.fx_a=0):this.fx!=this.fx_a&&(this.tiaozheng(11),this.fx_a=this.fx),"2"==this.fo?(this.isAlpha=!0,this.context.alpha=.5):1==this.isAlpha&&(this.isAlpha=!1,this.context.alpha=1)},e}(egret.DisplayObjectContainer);egret.registerClass(Monster,"Monster");var ResPlayer=function(t){function e(){t.call(this),this.Group_Zu=[],this.Zu=[],this.isJZ=!1,this.timer=new egret.Timer(1e3),this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.timer.start()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t,e,i,s){if(console.warn("加载:"+t),this.isGroup(t));else{var n=new GroupStringA;n.g_name=t,n.j_name=e,n.p_name=i,n.z_name=s,this.Zu.push(n)}},s.onTimer=function(t){this.isJZ||this.Zu.length>0&&(this.isJZ=!0,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup(this.Zu[0].g_name))},s.onResourceLoadError=function(t){console.warn("加载失败Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},s.onResourceProgress=function(t){},s.onResourceLoadComplete=function(t){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.Group_Zu.push(t.groupName),RoleConstant.skin_zu.push(this.Zu[0]),console.warn("加载完成:"+t.groupName),this.dispatchEvent(new egret.Event(t.groupName)),this.Zu.splice(0,1),this.isJZ=!1},s.isGroup=function(t){var e=0,i=!1;for(e;e<this.Group_Zu.length;e++)if(t==this.Group_Zu[e]){i=!0;break}return i},e}(egret.Sprite);egret.registerClass(ResPlayer,"ResPlayer");var Role=function(t){function e(){t.call(this),this.key=0,this.timer=new egret.Timer(50),this.step=0,this.step2=0,this.i=0,this.n=0,this.kaiguan=!0,this.m_josn="",this.m_texture="",this.m_name="",this.is_attack=!1,this.j=0,this.m=!0}__extends(e,t);var i=(__define,e),s=i.prototype;return s.startRole=function(t,e,i,s,n){this.playerPool=t,this.action(n),this.Xuan(n);var o=RES.getRes(e+this.m_josn),r=RES.getRes(i+this.m_texture);return this.mcf=new egret.MovieClipDataFactory(o,r),this.mc=new egret.MovieClip(this.mcf.generateMovieClipData(s+this.m_name)),this.mc.gotoAndPlay(this.i),this.addChild(this.mc),this.mc.x-=395+this.mc.width/2,this.mc.y-=388,this.mc.stop(),this.isTimer(!0),this.mc},s.setTimer=function(t){this.timer.delay=t},s.isTimer=function(t){t?this.timer.running||(this.timer.addEventListener(egret.TimerEvent.TIMER,this.onRoleTimer,this),this.timer.start()):this.timer.running&&(this.timer.removeEventListener(egret.TimerEvent.TIMER,this.onRoleTimer,this),this.timer.stop())},s.action=function(t){this.is_attack=!1;var e=120;t>=1&&5>=t?(this.m_josn="_attack_json",this.m_texture="_attack_png",this.m_name="_attack",this.is_attack=!0):t>=6&&10>=t?(this.m_josn="_idle_json",this.m_texture="_idle_png",this.m_name="_idle",e=250):t>=11&&15>=t?(this.m_josn="_walk_json",this.m_texture="_walk_png",this.m_name="_walk"):t>=15&&18>=t&&(this.m_josn="_death_json",this.m_texture="_death_png",this.m_name="_death"),this.setTimer(e)},s.Xuan=function(t){switch(t){case 1:this.i=1,this.n=7;break;case 2:this.i=8,this.n=14;break;case 3:this.i=15,this.n=21;break;case 4:this.i=22,this.n=28;break;case 5:this.i=29,this.n=35;break;case 6:this.i=1,this.n=7;break;case 7:this.i=8,this.n=14;break;case 8:this.i=15,this.n=21;break;case 9:this.i=22,this.n=28;break;case 10:this.i=29,this.n=35;break;case 11:this.i=1,this.n=7;break;case 12:this.i=8,this.n=14;break;case 13:this.i=15,this.n=21;break;case 14:this.i=22,this.n=28;break;case 15:this.i=29,this.n=35;break;case 16:this.i=1,this.n=8;break;case 17:this.i=9,this.n=16;break;case 18:this.i=17,this.n=25;break;default:this.i=1,this.n=7}},s.onRoleTimer=function(t){this.step2!=this.step&&(this.step2=this.step,this.Xuan(this.step)),this.j>=this.n-this.i?this.j=0:this.j+=1,this.mc.gotoAndStop(this.i+this.j)},e}(egret.Sprite);egret.registerClass(Role,"Role");var RolePool=function(t){function e(){t.call(this),this.key=0,this.Ro_Zu=[],this.playerPool="",this.j_josn="",this.t_texture="",this.n_name=""}__extends(e,t);var i=(__define,e),s=i.prototype;return s.destroyObject=function(t){var e=0,i=!1;for(e;e<this.Ro_Zu.length;e++)if(t==this.Ro_Zu[e].key){i=!0;break}i&&this.Ro_Zu.splice(e,1)},s.getRole=function(t,e){var i=0,s=!1;for(i;i<this.Ro_Zu.length;i++)if(t==this.Ro_Zu[i].key&&this.playerPool==this.Ro_Zu[i].playerPool){s=!0;break}if(s)return this.Ro_Zu[i].isTimer(!0),this.Ro_Zu[i];var n=new Role;return n.isTimer(!0),n.startRole(this.playerPool,this.j_josn,this.t_texture,this.n_name,e),n.key=t,n.step=e,this.Ro_Zu.push(n),n},e}(egret.Sprite);egret.registerClass(RolePool,"RolePool");var RoleConstant=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e);i.prototype;return e.rolePool=new RolePool,e.hP=0,e.skin_zu=[],e}(egret.Sprite);egret.registerClass(RoleConstant,"RoleConstant");var Tmd=function(){function t(){this.aaa=0,this.bbb=""}var e=(__define,t),i=e.prototype;return i.setTmd_a=function(t){this.aaa=t},i.getTmd_a=function(){return this.aaa},i.setTmd_b=function(t){this.bbb=t},i.getTmd_b=function(){return this.bbb},t}();egret.registerClass(Tmd,"Tmd");var GameScene=function(t){function e(){t.call(this),this.context=new egret.Sprite,this.lineScene=new egret.Sprite,this.pointScene=new egret.Sprite,this.out_x=0,this.out_y=0,this.mapPoint=new MapPoint,this.hero=new Hero,this.Monster_zu=[],this.timer=new egret.Timer(500),this.heroSetp=0,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.init,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.map_E=new MapLoad,this.addChild(this.context),this.map_E.addEventListener("LoadOk",this.onSceneEvent,this)},s.onSceneEvent=function(t){this.dispatchEvent(new egret.Event("mapLoadOk")),this.map_E.removeEventListener("LoadOk",this.onSceneEvent,this),this.addChild(this.hero),this.onLine(MapLoad.mapWidth,MapLoad.mapHeight,MapLoad.tileWidth,MapLoad.tileHeight),this.onPo(MapLoad.sceneArray,MapLoad.row,MapLoad.offsetY)},s.setLine=function(){this.lineScene.parent?this.removeChild(this.lineScene):this.addChild(this.lineScene)},s.setPo=function(){this.pointScene.parent?this.removeChild(this.pointScene):this.addChild(this.pointScene)},s.onLine=function(t,e,i,s){for(var n=s/2,o=i/2,r=Math.round(e/s*2),h=0;r>h;h++)this.line_A(o,0,0,n),this.line_A(0,e-n,o,e),n+=s,o+=i},s.line_A=function(t,e,i,s){var n=new egret.Shape;n.graphics.lineStyle(.5,16777215),n.graphics.moveTo(t,e),n.graphics.lineTo(i,s),n.graphics.endFill(),this.lineScene.addChild(n)},s.onPo=function(t,e,i){for(var s,n=30,o=15,r=0;e>r;r++)for(var h=0;e>h;h++)if(s=t[r][h],"0"!=s){var a=new egret.Shape;"1"==s&&a.graphics.lineStyle(.5,16711680),"2"==s&&a.graphics.lineStyle(.5,255),a.graphics.drawCircle(0,0,6),a.graphics.endFill(),a.x=n*(r-(i-h)),a.y=o*(r+i-h),this.pointScene.addChild(a)}},s.mapOk=function(t,e,i){this.map_E.playMusic(),this.hero.moveHero(t,e,i),this.out_x=t,this.out_y=e,this.isTimer(!0),this.moveScene(t,e,i)},s.moveScene=function(t,e,i){var s=egret.MainContext.instance.stage.stageWidth/2,n=egret.MainContext.instance.stage.stageHeight/2;this.tw=egret.Tween.get(this);var o=new egret.Point;o.x=0,o.y=0;for(var r,h=0,a=MapLoad.tileHeight,l=200,g=0,c=0,_=i.length;_>c;c++)r=Tile.getTilePointToStage(i[c].x,i[c].y),r.x=r.x-s,r.y=r.y/2-n,h=this.distance(o.x,o.y,r.x,r.y),g=h>a?2*l:l,this.tw.to({x:-r.x,y:-r.y},g),o.x=r.x,o.y=r.y},s.reMoveTw=function(){this.tw&&(this.tw.pause,this.tw=new egret.Tween.removeTweens(this));var t;t=this.hero.reMoveTw();var e=new egret.Point;e.x=this.x,e.y=this.y;this.hero.getHeroPoint();return t},s.isTimer=function(t){t?(this.timer.addEventListener(egret.TimerEvent.TIMER,this.onRoleTimer,this),this.timer.start()):(this.timer.removeEventListener(egret.TimerEvent.TIMER,this.onRoleTimer,this),this.timer.stop())},s.onRoleTimer=function(t){this.setHeroIndex(),this.out_x==Math.abs(this.x)&&this.out_y==Math.abs(this.y)&&this.isTimer(!1),this.heroSetp<=0?(this.heroSetp=2,this.loMap()):this.heroSetp-=1},s.loMap=function(){var t=MapLoad.imgWH,e=this.stage.stageWidth/2+t,i=this.stage.stageHeight/2+t;t/=2;var s,n=!1,o=this.map_E.mapsElement.length,r=this.hero.getHeroPoint();r.x+=240,r.y+=400;for(var h=new egret.Point,a=0;o>a;a++)n=!0,s=this.map_E.mapsElement[a],h.x=s.x+t,h.y=s.y+t,h.x>r.x-e&&h.x<r.x+e&&h.y>r.y-i&&h.y<r.y+i&&(s.isLoad?(this.context.addChild(s.mapsElement),n=!1):this.map_E.onMap(s,this.context)),n&&s.isLoad&&s.mapsElement.parent&&s.mapsElement.parent.removeChild(s.mapsElement)},s.setHeroIndex=function(){for(var t,e,i=this.stage.stageWidth/2,s=this.stage.stageHeight/2,n=this.Monster_zu.length,o=this.getChildIndex(this.hero),r=this.hero.getHeroPoint(),h=0;n>h;h++)this.Monster_zu[h].monster.parent||this.addChild(this.Monster_zu[h].monster),t=this.Monster_zu[h].monster.getHeroPoint(),t.x>r.x-i&&t.x<r.x+i&&t.y>r.y-s&&t.y<r.y+s?(e=this.getChildIndex(this.Monster_zu[h].monster),o>e&&r.y<t.y?this.swapChildren(this.Monster_zu[h].monster,this.hero):e>o&&r.y>t.y&&this.swapChildren(this.hero,this.Monster_zu[h].monster),this.Monster_zu[h].monster.isTimer(!0)):(this.Monster_zu[h].monster.parent&&this.removeChild(this.Monster_zu[h].monster),this.Monster_zu[h].monster.isTimer(!1))},s.distance=function(t,e,i,s){var n=Math.abs(t-i),o=Math.abs(e-s);return Math.max(n,o)},s.setHeroPoint=function(t,e){this.hero.setHeroPoint(t,e)},s.setMonster=function(t,e,i){var s=new MonsterType,n=new Monster;s.monster=n,s.key=t,s.monster.setHeroPoint(e,i),this.addChild(s.monster),this.Monster_zu.push(s)},e}(egret.Sprite);egret.registerClass(GameScene,"GameScene");var Type=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(Type,"Type");var imgName=function(){function t(){this.x=0,this.y=0,this.isLoad=!1}var e=(__define,t);e.prototype;return t}();egret.registerClass(imgName,"imgName");var GroupStringA=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(GroupStringA,"GroupStringA");var RoleType=function(){function t(){this.rolePool=new RolePool}var e=(__define,t);e.prototype;return t}();egret.registerClass(RoleType,"RoleType");var MonsterType=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(MonsterType,"MonsterType");